<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>confd_lib_ha</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="ConfD User Guide"><link rel="up" href="rn02.html" title="ConfD man-pages, Volume 3"><link rel="prev" href="rn02re11.html" title="confd_lib_events"><link rel="next" href="rn02re13.html" title="confd_lib_lib"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">confd_lib_ha</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="rn02re11.html">Prev</a>&nbsp;</td><th width="60%" align="center">ConfD man-pages, Volume 3</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="rn02re13.html">Next</a></td></tr></table><hr></div><div class="refentry"><a name="man.3.confd_lib_ha"></a><div class="titlepage"></div><div class="refnamediv"><a name="man.3.confd_lib_ha.name"></a><h2>Name</h2><p>confd_lib_ha &#8212; library for connecting to ConfD HA subsystem</p></div><div class="refsynopsisdiv"><a name="man.3.confd_lib_ha.synopsis"></a><h2>Synopsis</h2><div class="funcsynopsis"><pre class="funcsynopsisinfo">#include &lt;confd_lib.h&gt;
#include &lt;confd_ha.h&gt;
      </pre><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_connect</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>const struct sockaddr* <var class="pdparam">srv</var>, </td></tr><tr><td>&nbsp;</td><td>int <var class="pdparam">srv_sz</var>, </td></tr><tr><td>&nbsp;</td><td>const char *<var class="pdparam">token</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_bemaster</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>confd_value_t *<var class="pdparam">mynodeid</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_beslave</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>confd_value_t *<var class="pdparam">mynodeid</var>, </td></tr><tr><td>&nbsp;</td><td>struct confd_ha_node *<var class="pdparam">master</var>, </td></tr><tr><td>&nbsp;</td><td>int <var class="pdparam">waitreply</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_berelay</b>(</code></td><td>int <var class="pdparam">sock</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_benone</b>(</code></td><td>int <var class="pdparam">sock</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_get_status</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>struct confd_ha_status *<var class="pdparam">stat</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_slave_dead</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>confd_value_t *<var class="pdparam">nodeid</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div></div></div><div class="refsect1"><a name="man.3.confd_lib_ha.library"></a><h2>LIBRARY</h2><p>ConfD Library, (<code class="filename">libconfd</code>, <code class="option">-lconfd</code>)</p></div><div class="refsect1"><a name="man.3.confd_lib_ha.description"></a><h2>DESCRIPTION</h2><p>The <code class="filename">libconfd</code> shared library is used to
    connect to the ConfD High Availability (HA) subsystem. ConfD can
    replicate the configuration data on several nodes in a cluster. The
    purpose of this API is to manage the HA functionality. The details
    on usage of the HA API are described in the chapter <a class="link" href="ch24.html" title="Chapter&nbsp;24.&nbsp;High Availability">High availability</a> in the User
    Guide.</p></div><div class="refsect1"><a name="man.3.confd_lib_ha.functions"></a><h2>FUNCTIONS</h2><div class="funcsynopsis"><a name="fn.confd_ha_connect"></a><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_connect</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>const struct sockaddr* <var class="pdparam">srv</var>, </td></tr><tr><td>&nbsp;</td><td>int <var class="pdparam">srv_sz</var>, </td></tr><tr><td>&nbsp;</td><td>const char *<var class="pdparam">token</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div></div><p>Connect a HA socket which can be used to control a ConfD HA
  node.  The token is a secret string that must be shared by all
  participants in the cluster. There can only be one HA socket towards
  ConfD, a new call to <code class="function">confd_ha_connect()</code> makes
  ConfD close the previous connection and reset the token to the new
  value. Returns CONFD_OK or CONFD_ERR.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If this call fails (i.e. does not return CONFD_OK), the
  socket descriptor must be closed and a new socket created before the
  call is re-attempted.</p></div><div class="funcsynopsis"><a name="fn.confd_ha_bemaster"></a><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_bemaster</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>confd_value_t *<var class="pdparam">mynodeid</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div></div><p>Instruct a HA node to be master and also give the node a
  name. Returns CONFD_OK or CONFD_ERR.</p><p><span class="emphasis"><em>Errors:</em></span> CONFD_ERR_HA_BIND if we cannot
  bind the TCP socket, CONFD_ERR_BADSTATE if ConfD is still in start
  phase 0.</p><div class="funcsynopsis"><a name="fn.confd_ha_beslave"></a><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_beslave</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>confd_value_t *<var class="pdparam">mynodeid</var>, </td></tr><tr><td>&nbsp;</td><td>struct confd_ha_node *<var class="pdparam">master</var>, </td></tr><tr><td>&nbsp;</td><td>int <var class="pdparam">waitreply</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div></div><p>Instruct a ConfD HA node to be slave with a named master. The
  <em class="parameter"><code>waitreply</code></em> is a boolean int. If 1, the function
  is synchronous and it will hang until the node has initialized its
  CDB database. This may mean that the CDB database is copied in its
  entirety from the master.  If 0, we do not wait for the reply, but it
  is possible to use a notifications socket and get notified
  asynchronously via a HA_INFO_BESLAVE_RESULT notification. In both cases,
  it is also possible to use a notifications socket and get notified
  asynchronously when CDB at the slave is initialized.</p><p>If the call of this function fails with
  <code class="varname">confd_errno</code> CONFD_ERR_HA_CLOSED, it means that
  the initial synchronization with the master failed, either due to
  the socket being closed or due to a timeout while waiting for a
  response from the master. The function will fail with error
  CONFD_ERR_BADSTATE if ConfD is still in start phase 0.</p><p><span class="emphasis"><em>Errors:</em></span> CONFD_ERR_HA_CONNECT,
  CONFD_ERR_HA_BADNAME, CONFD_ERR_HA_BADTOKEN, CONFD_ERR_HA_BADFXS,
  CONFD_ERR_HA_BADVSN, CONFD_ERR_HA_CLOSED, CONFD_ERR_BADSTATE</p><div class="funcsynopsis"><a name="fn.confd_ha_berelay"></a><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_berelay</b>(</code></td><td>int <var class="pdparam">sock</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div></div><p>Instruct an established HA slave node to be a relay for other
  slaves. This can be useful in certain deployment scenarios, but makes
  the management of the cluster more complex. Read more about this in
  the <a class="link" href="ch24.html#ug.ha.relay_slaves" title="24.8.&nbsp;Relay slaves">Relay slaves</a> section
  of the High availability chapter in the User Guide. Returns CONFD_OK
  or CONFD_ERR.</p><p><span class="emphasis"><em>Errors:</em></span> CONFD_ERR_HA_BIND if we cannot
  bind the TCP socket, CONFD_ERR_BADSTATE if the node is not already a
  slave.</p><div class="funcsynopsis"><a name="fn.confd_ha_benone"></a><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_benone</b>(</code></td><td>int <var class="pdparam">sock</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div></div><p>Instruct a node to resume the initial state, i.e. neither
  master nor slave.</p><p><span class="emphasis"><em>Errors:</em></span> CONFD_ERR_BADSTATE if ConfD is
  still in start phase 0.</p><div class="funcsynopsis"><a name="fn.confd_ha_get_status"></a><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_get_status</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>struct confd_ha_status *<var class="pdparam">stat</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div></div><p>Query a ConfD HA node for its status. If successful, the
  function populates the confd_ha_status structure. This is the only
  HA related function which is possible to call while the ConfD daemon
  is still in start phase 0.</p><div class="funcsynopsis"><a name="fn.confd_ha_slave_dead"></a><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">confd_ha_slave_dead</b>(</code></td><td>int <var class="pdparam">sock</var>, </td></tr><tr><td>&nbsp;</td><td>confd_value_t *<var class="pdparam">nodeid</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&nbsp;</div></div><p>This function must be used by the application to inform ConfD
  HA subsystem that another node which is possibly connected to ConfD
  is dead.</p><p><span class="emphasis"><em>Errors:</em></span> CONFD_ERR_BADSTATE if ConfD is
  still in start phase 0.</p></div><div class="refsect1"><a name="man.3.confd_lib_ha.see_also"></a><h2>SEE ALSO</h2><p><span class="citerefentry"><span class="refentrytitle">confd.conf</span>(5)</span> - ConfD daemon configuration file format</p><p>The ConfD User Guide</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rn02re11.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="rn02.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="rn02re13.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">confd_lib_events&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;confd_lib_lib</td></tr></table></div></body></html>