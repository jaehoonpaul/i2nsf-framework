<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;16.&nbsp;The CLI agent</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="ConfD User Guide"><link rel="up" href="index.html" title="ConfD User Guide"><link rel="prev" href="ch15.html" title="Chapter&nbsp;15.&nbsp;The NETCONF Server"><link rel="next" href="ch17.html" title="Chapter&nbsp;17.&nbsp;The SNMP Agent"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;16.&nbsp;The CLI agent</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch15.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch17.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="ug.cli"></a>Chapter&nbsp;16.&nbsp;The CLI agent</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="ch16.html#d5e5846">16.1. Overview</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e5905">16.2. The J-style CLI</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e5939">16.3. The C- and I-style CLI</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e5970">16.4. The CLI in action</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6080">16.5. Environment for OS command execution</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6088">16.6. Command output processing</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6213">16.7. Range expressions</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6232">16.8. Autorendering of enabled/disabled</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6251">16.9. Actions</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6266">16.10. Command history</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6269">16.11. Clearing history</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6272">16.12. Command line editing</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6397">16.13. Using CLI completion</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6435">16.14. Using the comment characters # or !</a></span></dt><dt><span class="sect1"><a href="ch16.html#ug.cli.annotations">16.15. Annotations and tags</a></span></dt><dt><span class="sect1"><a href="ch16.html#ug.cli.inactive">16.16. Activate and Deactivate</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6497">16.17. CLI messages</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6505">16.18. confd.conf settings</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6509">16.19. CLI Environment</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e6606">16.20. Commands in J-style</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e7306">16.21. Commands in C/I-style</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e8047">16.22. Customizing the CLI</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e8190">16.23. User defined wizards</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e8209">16.24. User defined wizards in C</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e8241">16.25. User defined commands in C using the C-API</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e8250">16.26. User defined commands as shell scripts</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e8259">16.27. Modifying built-in commands</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e8295">16.28. Tailoring show commands</a></span></dt><dt><span class="sect1"><a href="ch16.html#d5e8339">16.29. Change password at initial login</a></span></dt></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e5846"></a>16.1.&nbsp;Overview</h2></div></div></div><p>
        Confd provides three different CLI styles, one inspired by the
        Junos CLI (J), one inspired by the Cisco XR CLI (C), and
        one inspired by the Cisco IOS CLI (I).
        All styles can be supported at the same time, or one style
        can be chosen for a given deployment of ConfD.  The default
        style is configured in the <code class="filename">confd.conf</code>
        file using the
        <span class="emphasis"><em>style</em></span> setting in the <span class="emphasis"><em>cli</em></span> section.
      </p><p>
        The CLI is automatically rendered using the
        data model described by the  <span class="emphasis"><em>yang</em></span>
        files.
        This way we get an auto-generated CLI, without any extra
        effort, except the design of our yang files. The
        auto-generated CLI supports the following features:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Command line history and command line editor.
          </p></li><li class="listitem"><p>
            Tab completion for content of the configuration database.
          </p></li><li class="listitem"><p>
            Monitoring and inspecting log files.
          </p></li><li class="listitem"><p>
            Inspecting the system configuration and system state.
          </p></li><li class="listitem"><p>
            Fully configuring the system.
          </p></li></ul></div><p>
        Alias expansion is performed when a command line is
        entered. Aliases are part of the configuration and
        are manipulated accordingly. In the J-style
        CLI this is done by manipulating the nodes in the
        alias configuration tree. In the C- and I-style CLIs
        this is done by the alias command in configuration mode.
      </p><p>
        The C- and I-style CLIs automatically create modes for each
        list node in the <span class="emphasis"><em>yang</em></span> files, and commands
        for setting each parameter are generated. Actions specified
        in the <span class="emphasis"><em>yang</em></span> files are mapped to commands in the
        mode where they appear.
      </p><p>
        The J-style CLI contains commands for manipulating
        the configuration and actions in the <span class="emphasis"><em>yang</em></span>
        files are mapped into <span class="command"><strong>request</strong></span> commands in
        operational mode.
      </p><p>
        Even though the auto-generated CLI is fully functional it can
        be customized and extended in numerous ways:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Built-in commands can be moved, deleted and reordered.
          </p></li><li class="listitem"><p>
            Confirmation prompts can be added to built-in commands.
          </p></li><li class="listitem"><p>New commands can be implemented using the C-API and
        ordinary executables, and shell scripts can be invoked from
        a command.</p></li><li class="listitem"><p>New commands can be mounted freely in the existing
        command hierarchy.</p></li><li class="listitem"><p>The built-in tab completion mechanism can be overridden using user defined callbacks.</p></li><li class="listitem"><p>New command hierarchies can be created.</p></li><li class="listitem"><p>A command timeout can be added, both a global timeout
        for all commands, and command specific timeouts.</p></li><li class="listitem"><p>Actions and parts of the data tree can be hidden
        and can later be made visible when the user enters a
        password.</p></li></ul></div><p>
        In the C- and I-style CLIs some additional customizations are
        possible.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The automatically generated modes can be suppressed.</p></li><li class="listitem"><p>New modes can be added at internal nodes.</p></li><li class="listitem"><p>The builtin show output can be replaced with an arbitrary
        command, either for the whole configuration or just parts of it.
        </p></li><li class="listitem"><p>Custom mode names can be assigned statically or
        dynamically through a C-callback</p></li><li class="listitem"><p>Transactions can be disabled so that all CLI
        modifications take effect immediately. The IOS style CLI
        automatically disables transactions.</p></li></ul></div><p>
        How to customize and extend the auto-generated CLI is described
        in the <span class="emphasis"><em>clispec(5)</em></span> manual page.
      </p><p>
        Tip: In the ConfD distribution there is an Emacs mode suitable
        for clispec editing.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e5905"></a>16.2.&nbsp;The J-style CLI</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5907"></a>16.2.1.&nbsp;Command Hierarchy</h3></div></div></div><p>
            The CLI is built around a hierarchy of commands. This makes
            it possible to logically group commands. The
            operational mode command hierarchy looks like this for the
            XR CLI:
          </p><pre class="programlisting">--|- commit
  |- compare -
  |         |- file
  |         |- startup
  |- configure
  |- file ---
  |         |- list
  |         |- show
  |         |- rename
  |         |- delete
  |         |- compare -
  |         |          |- files
  |         |- copy
  |- help
  |- id
  |- monitor -
  |          |
  |          |- stop
  |          |- start
  |- ping
  |- quit
  |- request -
  |          |- &lt;action&gt;
  |          |- job -
  |                 |- stop
  |          |- message
  |          |- system -
  |                    |- logout -
  |                              |- user
  |
  |- set
  |- set-path
  |- show ---
  |          |- all
  |          |- jobs
  |          |- users
  |          |- status
  |          |- configuration
  |          |- cli
  |          |- cli -
  |          |      |- history
  |          |- log
  |          |- notification
  |          |- parser -
  |          |         |- dump
  |- source
  |- ssh
  |- telnet
  |- traceroute</pre><p>
            The configure mode command hierarchy looks like this:
          </p><pre class="programlisting">--|- activate
  |- annotate
  |- commit -
  |         |- confirmed
  |         |- check
  |         |- and-quit
  |- compare -
  |          |- file
  |          |- running
  |- deactivate
  |- delete
  |- edit
  |- exit
  |- help
  |- hide
  |- insert
  |- move
  |- load
  |- quit
  |- rename
  |- revert
  |- rollback
  |- run
  |- save
  |- set
  |- show -
  |       |- parser -
  |       |         |- dump
  |- status
  |- tag -
  |      |- add
  |      |- clear
  |      |- del
  |- top
  |- unhide
  |- up
  |- validate
  |- wizard -
  |- adduser</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5913"></a>16.2.2.&nbsp;Two CLI modes</h3></div></div></div><p>
            The ConfD CLI provides various commands for configuring and
            monitoring software, hardware, and network connectivity of
            target devices. The CLI supports two modes: <span class="emphasis"><em>operational
            mode</em></span>, for monitoring the state of the device; and
            <span class="emphasis"><em>configure mode</em></span>, for changing the state of the
            device.
          </p><p>
            The prompt indicates which mode the CLI is in. When moving from
            operational mode to configure mode using the
            <span class="command"><strong>configure</strong></span> command, the prompt is changed from
            <code class="prompt">user@host&gt;</code> to <code class="prompt">user@host%</code>.
            The prompts can be configured using the
            <em class="parameter"><code>prompt1</code></em> and <em class="parameter"><code>prompt2</code></em>
            settings in the <code class="filename">confd.conf</code> file.
          </p><p>For example:</p><pre class="screen">joe@io&gt; configure
Entering configuration mode "private"

[ok][2006-06-02 12:31:59]
[edit]
joe@io%</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5927"></a>16.2.3.&nbsp;Operational mode</h3></div></div></div><p>
            Operational mode is the initial mode after successful login
            to the CLI. It is primarily used for viewing the system status,
            controlling the CLI environment, monitoring and
            troubleshooting network connectivity, and initiating the
            configure mode.
          </p><p>
            The full list of commands available in operational mode is
            listed below in the "Operational mode commands" section.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5931"></a>16.2.4.&nbsp;Configure mode</h3></div></div></div><p>
            Configure mode can be initiated by entering the
            <span class="command"><strong>configure</strong></span> command in operational mode. All
            changes to the
            device's configuration are done to a copy of the active
            configuration, called a <span class="emphasis"><em>candidate
            configuration</em></span>. These
            changes do not take effect until a successful
            <span class="command"><strong>commit</strong></span> or
            <span class="command"><strong>commit confirm</strong></span> command is entered.
          </p><p>
            The full list of commands available in configure mode is
            listed below in the "Configure mode commands" section.
          </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e5939"></a>16.3.&nbsp;The C- and I-style CLI</h2></div></div></div><p>
        The C- and I-style CLI is inspired by the Cisco XR CLI and
        Cisco IOS CLI. The configuration is manipulated through a
        series of commands and modes. Each parameter in the
        <span class="emphasis"><em>yang</em></span> files is represented by a separate command.
      </p><p>
        The CLI provides various commands for configuring and
        monitoring software, hardware, and network connectivity of
        target devices. The CLI supports two modes: <span class="emphasis"><em>operational
        mode</em></span>, for monitoring the state of the device; and
        <span class="emphasis"><em>configure mode</em></span>, for changing the state of the
        device. The <span class="emphasis"><em>configure mode</em></span> consists of a number
        of sub-modes for manipulating different parts of the
        configuration, i.e. the mode <span class="command"><strong>aaa authentication users
        user</strong></span> is present for configuring user authentication
        parameters.
      </p><p>
        The prompt indicates which mode the CLI is in. When moving from
        operational/EXEC mode to configure mode using the
        <span class="command"><strong>config</strong></span>
        command, the prompt is changed from <code class="prompt">host#</code> to
        <code class="prompt">host(mode)#</code>. The prompts can be configured using the
        <em class="parameter"><code>cPrompt1</code></em> and
        <em class="parameter"><code>cPrompt2</code></em> settings in the
        <code class="filename">confd.conf</code> file, and additionally in the IOS style
        through the prompt setting in the AAA configuration.
      </p><p>For example:</p><pre class="screen">joe connected from 127.0.0.1 using console on io
io# config terminal
Entering configuration mode private
io(config)# </pre><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5957"></a>16.3.1.&nbsp;Operational/EXEC mode</h3></div></div></div><p>
            Operational mode is the initial mode after successful login
            to the CLI. It is primarily used for viewing the system status,
            controlling the CLI environment, monitoring and
            troubleshooting network connectivity, and initiating the
            configure mode.
          </p><p>
            The full list of commands available in operational mode is
            listed below in the "Operational mode commands" section.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5961"></a>16.3.2.&nbsp;Configure mode</h3></div></div></div><p>
            Configure mode can be initiated by entering the
            <span class="command"><strong>config</strong></span> command in operational mode. All changes
            to the
            device's configuration are done to a copy of the active
            configuration, called a <span class="emphasis"><em>candidate
            configuration</em></span>. These
            changes do not take effect until a successful
            <span class="command"><strong>commit</strong></span> or
            <span class="command"><strong>commit confirm</strong></span> command is entered.
          </p><p>
            The full list of commands available in configure mode is
            listed below in the "Configure mode commands" section. Additional
            commands and modes are dynamically derived from the
            <span class="emphasis"><em>yang</em></span> files.
          </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e5970"></a>16.4.&nbsp;The CLI in action</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ug.cli.starting"></a>16.4.1.&nbsp;Starting the CLI</h3></div></div></div><p>
            The CLI is started using the <span class="command"><strong>confd_cli</strong></span>
            program.  It can either be used as a login program or
            started manually once the user has logged in.
          </p><p>
            In a typical device, ordinary users would have the
            <span class="command"><strong>confd_cli</strong></span> program as login shell, and
            the root user would have to login and then start the CLI
            using <span class="command"><strong>confd_cli</strong></span>.
          </p><p>
            <span class="command"><strong>confd_cli</strong></span> is a fairly small program
            (about 800 lines of C code) which we distribute both as a
            binary and source code (in
            <code class="filename">$CONFD_DIR/src/confd/cli</code>). When
            started it sets the terminal in raw mode, connects to the
            ConfD daemon through a socket over the loopback interface,
            and sends user name, the user's groups, protocol, client
            IP address, terminal settings etc., and then enters a
            proxying mode where it sends key strokes from the user and
            prints characters sent by the ConfD daemon.
          </p><p>
            It is straightforward to modify the C program to send, for
            example, custom group information. The default behavior is
            to send the UNIX groups the user belongs to.
          </p><p>
            Out of the box, the <span class="command"><strong>confd_cli</strong></span> program
            supports a range of options, primarily intended for debug
            and development purposes.
          </p><p>
            The <span class="command"><strong>confd_cli</strong></span> program can also be used
            for batch processing of CLI commands, either by storing
            the commands in a file and running
            <span class="command"><strong>confd_cli</strong></span> on the file, or by having the
            following line at the top of the file (with the location
            of the program modified appropriately):
          </p><pre class="programlisting">#!/bin/confd_cli</pre><p>
            When the CLI is run non-interactively it will terminate at
            the first error and will only show the output of the
            commands executed.  It will not output the prompt or echo
            the commands. This is the same behavior as for shell
            scripts.
          </p><p>
            If you want to run a script non-interactively, e.g. as a script
            or through a pipe, and still want the prompts and commands
            echoed, you can give the <span class="command"><strong>--interactive</strong></span> option.
          </p><p>
            Command line options:
          </p><pre class="screen">confd_cli --help
Usage: confd_cli [options] [file]
Options:
--help, -h            display this help
--host, -H &lt;host&gt;     current host name (used in prompt)
--address, -A &lt;addr&gt;  cli address to connect to
--port, -P &lt;port&gt;     cli port to connect to
--cwd,  -c &lt;dir&gt;      current working directory
--proto, -p &lt;proto&gt;   type of connection (tcp, ssh, console)
--verbose, -v         verbose output
--ip, -i              clients source ip
--interactive, -n     force interactive mode
--juniper, -J         Juniper style CLI
--cisco, -C           Cisco XR style CLI
--user, -u &lt;user&gt;     clients user name
--uid, -U &lt;uid&gt;       clients user id
--groups, -g &lt;groups&gt; clients group list
--gids, -D &lt;gids&gt;     clients group id list
--gid, -G &lt;gid&gt;       clients group id
--noaaa               disable AAA</pre><p>
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">host</span></dt><dd><p>The argument to host should be the host name of the device.
                The <span class="command"><strong>confd_cli</strong></span> program will use the result of the
                system call
                <code class="function">gethostname()</code> as default value. The host
                name is used in the CLI prompt.</p></dd><dt><span class="term">address</span></dt><dd><p>If ConfD has been configured to listen to a
                different address than 127.0.0.1 for the communication
                between subsystems, then that address should be given as
                argument to <code class="option">address</code> (or we can use the
                <code class="varname">CONFD_IPC_ADDRESS</code> environment
                variable, or recompile the <span class="command"><strong>confd_cli</strong></span>
                program with the new address compiled in).</p></dd><dt><span class="term">port</span></dt><dd><p>If ConfD has been configured to use a non-default
                port for the communication between subsystems, then that
                port number should be given as argument to
                <code class="option">port</code> (or we can use the
                <code class="varname">CONFD_IPC_PORT</code> environment variable,
                or recompile the <span class="command"><strong>confd_cli</strong></span> program
                with the new port compiled in).</p></dd><dt><span class="term">cwd</span></dt><dd><p>Directory to use as current working directory in the CLI.
                Normally the user's home directory. The default is the directory
                where the <span class="command"><strong>confd_cli</strong></span> program is started.</p></dd><dt><span class="term">proto</span></dt><dd><p>Should be the protocol used by the user to connect to the
                box, one of <span class="command"><strong>tcp</strong></span>, <span class="command"><strong>ssh</strong></span>, and
                <span class="command"><strong>console</strong></span>. The default is
                <span class="command"><strong>ssh</strong></span> for
                connections established with OpenSSH (the program inspects
                the SSH_CONNECTION environment variable), and
                <span class="command"><strong>console</strong></span>
                for everything else. This value is printed in the audit logs.</p></dd><dt><span class="term">verbose</span></dt><dd><p>If this argument is given, then the <span class="command"><strong>confd_cli</strong></span> program
                will be a bit more talkative during the ConfD handshake
                phase.</p></dd><dt><span class="term">ip</span></dt><dd><p>Should be the user's source IP address, if the user connects
                through SSH or telnet. The default is 127.0.0.1 to indicate
                the console. This value is printed in the audit logs.</p></dd><dt><span class="term">interactive</span></dt><dd><p>Force the CLI to echo commands and prompts even when not
                invoked from a terminal, i.e. when reading input from a file
                or through a pipe.</p></dd><dt><span class="term">cisco</span></dt><dd><p>Force the CLI to provide a I-style CLI.</p></dd><dt><span class="term">juniper</span></dt><dd><p>Force the CLI to provide a Juniper style CLI.</p></dd><dt><span class="term">user</span></dt><dd><p>The name of the user connecting. Used to set proper
                access rules and assign proper groups (if the group
                mapping is kept in ConfD). The default is to use the
                login name of the user.</p></dd><dt><span class="term">uid</span></dt><dd><p>The numeric user id of the connected user. The uid will be used
                when executing osCommands, when checking file access
                permissions, and when creating files. Note that ConfD
                needs to run as root for this to work properly.</p></dd><dt><span class="term">gid</span></dt><dd><p>The numeric group id of the connected user. The gid will be used
                when executing osCommands, when checking file access
                permissions, and when creating files. Note that ConfD
                needs to run as root for this to work properly.</p></dd><dt><span class="term">groups</span></dt><dd><p>The argument to groups should be a comma-separated list
                of groups. The default is to send the OS groups that the
                user belongs to, i.e. the same as the <span class="command"><strong>groups</strong></span>
                shell command gives us.</p></dd><dt><span class="term">gids</span></dt><dd><p>The argument to gids should be a comma-separated list of
                numeric group ids representing the Unix supplementary groups
                for the user. These are used when executing osCommands and
                when checking file access permissions.</p></dd><dt><span class="term">noaaa</span></dt><dd><p>Disables AAA. This is useful during development but
                should be removed in a production system.</p></dd></dl></div><p>
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6076"></a>16.4.2.&nbsp;Starting the CLI in an overloaded system</h3></div></div></div><p>
            If the number of ongoing sessions have reached the
            configured system limit, no more CLI sessions will be
            allowed until one of the existing sessions have been
            terminated.
          </p><p>
            This makes it impossible to get into the system. A situation
            which may not be acceptable. The CLI therefore has a mechanism
            for handling this problem. When the CLI detects that the
            session limit has been reached it will check if the new user
            has privileges to execute the logout command. If the
            user does it will display a list of the current user sessions
            on the box and ask the user if one of the sessions should
            be terminated to make room for the new session.
          </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6080"></a>16.5.&nbsp;Environment for OS command execution</h2></div></div></div><p>
        All OS commands, i.e. executables or shell scripts, are
        executed using a program called <span class="command"><strong>cmdptywrapper</strong></span>. To be
        able to execute an os-command as root or a specific user we
        need to make <span class="command"><strong>cmdptywrapper</strong></span> setuid root, i.e.
      </p><pre class="screen"># chown root cmdptywrapper
# chmod u+s cmdptywrapper</pre><p>
        Failing that, all programs will be executed as the user
        who started the ConfD daemon. Consequently, if that user
        is root we do not have to perform the
        <span class="command"><strong>chmod</strong></span> operation above.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6088"></a>16.6.&nbsp;Command output processing</h2></div></div></div><p>
        It is possible to process the output from a command using an
        output redirect. This is done using the | character. This
        redirect feature is supported in both the C- and I-style and
        the J-style CLI. Most of the commands are the same but some
        commands differ. The redirect targets (pipe commands) can be
        modified using the clispec file, just as a regular CLI
        command. The commands can be chained to achieve more complex
        processing.
      </p><p>
        In the J-style CLI the commands are called - append, count,
        display set (show configuration only), display annotations,
        display json, display keypath, display xml, display xpath,
        show tags, hide annotations, hide tags, except (exclude),
        extended, find (begin), linnum, match (include), match-all, match-any,
        more, nomore, notab (auto-rendered show commands only), repeat
        (auto-rendered show commands only), save, tab (show commands
        only) and until. It may look look this in the J-style CLI:
      </p><pre class="screen">admin@tellus&gt; show configuration | ?
Possible completions:
  annotation  - Show only statements whose annotation matches a pattern
  append      - Append output text to a file
  best-effort - Display data even if data provider is unavailable or continue loading from file in presence of failures
  count       - Count the number of lines in the output
  details     - Display details
  display     - Display options
  except      - Show only text that does not matches a pattern
  extended    - Show referring elements
  find        - Search for the first occurrence of a pattern
  hide        - Hide display options
  linnum      - Enumerate lines in the output
  match       - Show only text that matches a pattern
  match-all   - All selected filters must match
  match-any   - At least one filter must match
  more        - Paginate output
  nomore      - Suppress pagination
  save        - Save output text to a file
  select      - Select additional columns
  sort-by     - Select sorting indices
  tab         - Enforce table output
  tags        - Show only statements whose tags matches a pattern
  until       - Display until the first occurrence of a pattern
</pre><p>
       In the C- and I-style CLIs the commands are called - append,
       count, exclude (except), display annotations, display tags,
       hide annotations, hide tags, begin (find), include (match),
       linnum, match-all, match-any, more, nomore,
       notab (auto-rendered show commands only),
       repeat (auto-rendered show commands only), save, tab (show
       commands only) and until.  It may look look this in the C- and
       I-style CLI:
      </p><pre class="screen">tellus# show running-config | ?
Possible completions:
  annotation   Show only statements whose annotation matches a pattern
  append       Append output text to a file
  begin        Begin with the line that matches
  count        Count the number of lines in the output
  details      Display commit progress
  display      Display options
  exclude      Exclude lines that match
  extended     Display referring entries
  hide         Hide display options
  include      Include lines that match
  linnum       Enumerate lines in the output
  match-all    All selected filters must match
  match-any    At least one filter must match
  more         Paginate output
  nomore       Suppress pagination
  save         Save output text to a file
  select       Select additional columns
  sort-by      Select sorting indices
  tab          Enforce table output
  tags         Show only statements whose tags matches a pattern
  until        End with the line that matches
</pre><p>
        The <span class="command"><strong>show annotations/tags</strong></span> and
        <span class="command"><strong>hide annotations/tags</strong></span> pipe targets are only
        available when viewing the configuration, and only if attributes
        have been enabled in the confd.conf file.
      </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6098"></a>16.6.1.&nbsp;Sort the the Output</h3></div></div></div><p>
          The <span class="command"><strong>sort-by</strong></span> target makes it possible for the
          CLI user to control in which order instances should be displayed,
          and can be used when the path points to a list.
          The argument to <span class="command"><strong>sort-by</strong></span> can either be a  secondary
          index or an arbitrary set of leafs in the list.
          If a secondary index is given as an argument, the table will be sorted
          in the order defined by the secondary index. If a set of leafs is
          given as an argument, the table will be sorted in the order in which
          the leafs are entered. For example:
        </p><pre class="screen">admin@io 13:28:07&gt; show configuration server | sort-by port ip | tab

NAME  IP        PORT  DESCRIPTION
-----------------------------------
1     1.1.1.1   1010  -
7     1.1.1.17  1020  -
10    1.1.1.11  1040  -
3     1.1.1.3   1070  -
6     1.1.1.4   1070  -
5     1.1.1.5   1070  -
4     1.1.1.7   1070  -
8     1.1.1.8   1070  -
9     1.1.1.9   1070  -
11    1.1.1.10  1070  -
2     1.1.1.12  1070  -

[ok][2013-08-31 13:49:44]
admin@io 13:50:12&gt;</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6104"></a>16.6.2.&nbsp;Count the Number of Lines in the Output</h3></div></div></div><p>
            This redirect target counts the number of lines in the
            output. For example:
          </p><pre class="screen">admin@io 13:28:07&gt; show configuration | count
[ok][2007-08-31 13:49:44]
Count: 99 lines
admin@io 13:49:44&gt; show configuration aaa | count
[ok][2007-08-31 13:50:12]
Count: 90 lines
admin@io 13:50:12&gt;</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6108"></a>16.6.3.&nbsp;Search for a String in the Output</h3></div></div></div><p>
            The <span class="command"><strong>match</strong></span> target
            (<span class="command"><strong>include</strong></span> in C- and I- style) is used to
            only include lines matching a regular expression. For
            example:
          </p><pre class="screen">admin@io 13:53:59&gt; show configuration aaa | match {
aaa {
    authentication {
        users {
            user admin {
            user oper {
            user private {
            user public {
        groups {
            group admin {
            group oper {
    authorization {
        cmdrules {
            cmdrule 1 {
            cmdrule 2 {
            cmdrule 3 {
            cmdrule 150 {
        datarules {
            datarule 101 {
            datarule 203 {</pre><p>
            In the example above only lines containing { are shown. Similarly
            lines not containing a regular expression can be included. This
            is done using the <span class="command"><strong>except</strong></span> target
            (<span class="command"><strong>exclude</strong></span> in C- and I- style).
            For example:
          </p><pre class="screen">admin@io 13:56:30&gt; show configuration aaa authentication | except {
            uid        1000;
            gid        100;
            password   $1$fB$0w68PmacQ4VmE3/M3nK3Ug==;
            ssh_keydir /var/confd/homes/admin/.ssh;
            homedir    /var/confd/homes/admin;
        }
            uid        1000;
            gid        100;
            password   $1$S6$brGZW9wSDifHoU7Rf5KSHA==;
            ssh_keydir /var/confd/homes/oper/.ssh;
            homedir    /var/confd/homes/oper;
        }
            uid        1000;
            gid        100;
            password   $1$L4$YcCoIivO4mrzoj8vCrEjlw==;
            ssh_keydir /var/confd/homes/private/.ssh;
            homedir    /var/confd/homes/private;
        }
            uid        1000;
            gid        100;
            password   $1$Ft$9zTEc79NWFE0E8v7I2RxVQ==;
            ssh_keydir /var/confd/homes/public/.ssh;
            homedir    /var/confd/homes/public;
        }
    }
            users "admin private";
        }
            users "oper public";
        }
    }
}</pre><p>
            It is also possible to display the output starting at
            the first match of a regular expression, using the
            <span class="command"><strong>find</strong></span> target (<span class="command"><strong>begin</strong></span> in C- and I- style). For example:
          </p><pre class="screen">admin@io 14:03:44&gt; show configuration aaa authentication users | find private
user private {
    uid        1019;
    gid        1013;
    password   $1$AO$hbQEgdGQLzlWhX/1FNL5f.;
    ssh_keydir /var/confd/homes/private/.ssh;
    homedir    /var/confd/homes/private;
}
user public {
    uid        1019;
    gid        1013;
    password   $1$Kh$0Lor2g1yrSQ7MYDLxFr9h0;
    ssh_keydir /var/confd/homes/public/.ssh;
    homedir    /var/confd/homes/public;
}</pre><p>
           Output can also be ended when a line matches a regular
           expression. This is done with the <span class="command"><strong>until</strong></span>
           target. For example:
          </p><pre class="screen">admin@io 14:03:44&gt; show configuration aaa authentication users | find private | until public
user private {
    uid        1019;
    gid        1013;
    password   $1$AO$hbQEgdGQLzlWhX/1FNL5f.;
    ssh_keydir /var/confd/homes/private/.ssh;
    homedir    /var/confd/homes/private;
}
user public {</pre><p>
            It is also possible to filter the output by using a sequence of
            <span class="command"><strong>select</strong></span> statements followed by
            <span class="command"><strong>match-any</strong></span> or <span class="command"><strong>match-any</strong></span>.
           Consider the configuration:
          </p><pre class="screen">admin@io 14:03:44&gt; show configuration servers server
server a {
    ip   1.2.3.4;
    port 23;
}
server b {
    ip   2.3.4.5;
    port 24;
}
server c {
    ip   3.4.5.6;
    port 25;
}</pre><p>
            If we were to show all servers that has either ip 1.2.3.4
            <span class="emphasis"><em>or</em></span> port 24, this can be done by using select
            statements, like so
          </p><pre class="screen">admin@io 14:03:44&gt; show configuration servers server | select ip 1.2.3.4 | select port 24 | match-any
server a {
    ip   1.2.3.4;
    port 23;
}
server b {
    ip   2.3.4.5;
    port 24;
}</pre><p>
            whereas a <span class="command"><strong>match-all</strong></span> filtering would in this case
            result in
          </p><pre class="screen">admin@io 14:03:44&gt; show configuration servers server | select ip 1.2.3.4 | select port 24 | match-all
No entries found.</pre><p>
            as there are no servers that has both ip 1.2.3.4
            <span class="emphasis"><em>and</em></span> port 24.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6138"></a>16.6.4.&nbsp;Saving the Output to a File</h3></div></div></div><p>
            The output can also be saved to a file using the <span class="command"><strong>save</strong></span>
            or <span class="command"><strong>append</strong></span> redirect target. For example:
          </p><pre class="screen">admin@io 14:03:51&gt; show configuration aaa  | save /tmp/saved</pre><p>
            Or to save the configuration, except all passwords
          </p><pre class="screen">admin@io 14:03:51&gt; show configuration | except password | save /tmp/saved</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6146"></a>16.6.5.&nbsp;Regular expressions</h3></div></div></div><p>
            The regular expressions is a subset of the regular expressions
            found in egrep and in the AWK programming language. Some common
            operators are:
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">.</span></dt><dd><p>
                  Matches any character.
                </p></dd><dt><span class="term">^</span></dt><dd><p>
                  Matches the beginning of a string.
                </p></dd><dt><span class="term">$</span></dt><dd><p>
                  Matches the end of a string.
                </p></dd><dt><span class="term">[abc...]</span></dt><dd><p>
                  Character class, which matches any of the characters
                  abc... Char- acter ranges are specified by a pair of
                  characters separated by a -.
                </p></dd><dt><span class="term">[^abc...]</span></dt><dd><p>
                  negated character class, which matches any character
                  except abc....
                </p></dd><dt><span class="term">r1 | r2</span></dt><dd><p>
                  Alternation. It matches either r1 or r2.
                </p></dd><dt><span class="term">r1r2</span></dt><dd><p>
                  Concatenation. It matches r1 and then r2.
                </p></dd><dt><span class="term">r+</span></dt><dd><p>
                  Matches one or more rs.
                </p></dd><dt><span class="term">r*</span></dt><dd><p>
                  Matches zero or more rs.
                </p></dd><dt><span class="term">r?</span></dt><dd><p>
                  Matches zero or one rs.
                </p></dd><dt><span class="term">(r)</span></dt><dd><p>
                  Grouping. It matches r.
                </p></dd></dl></div><p>
            For example, to only display uid and gid you can do the
            following:
          </p><pre class="screen">admin@io 15:11:24&gt; show configuration | match "(uid)|(gid)"
                uid        1000;
                gid        100;
                uid        1000;
                gid        100;
                uid        1000;
                gid        100;
                uid        1000;
                gid        100;</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6196"></a>16.6.6.&nbsp;Display line numbers</h3></div></div></div><p>
          The <span class="command"><strong>linnum</strong></span> target causes a line number to
              be displayed at the beginning of each line in the
              display.
        </p><pre class="screen">admin@io 15:11:24&gt; show configuration | match "(uid)|(gid)" | linnum
1:                 uid        1019;
2:                 gid        1013;
3:                 uid        1019;
4:                 gid        1013;
5:                 uid        1019;
6:                 gid        1013;
7:                 uid        1019;
8:                 gid        1013;</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6201"></a>16.6.7.&nbsp;Display as format</h3></div></div></div><p>
          The <span class="command"><strong>display</strong></span> target can be used to
          display output in a set of output formats. Some of these
          output formats are unique to specific modes, such as
          configuration or operational mode. The output formats
          <span class="command"><strong>json</strong></span>, <span class="command"><strong>keypath</strong></span>,
          <span class="command"><strong>xml</strong></span>, and <span class="command"><strong>xpath</strong></span>
          are available in most modes and CLI styles (J, I, and C).
        </p><p>
          For instance, assuming we have a data model featuring a set of
          hosts, each containing a set of servers, we can display the
          configuration data as JSON. This is depicted in the example below.
        </p><pre class="screen">admin@io 15:11:24&gt; show configuration hosts | display json
{
  "data": {
    "pipetargets_model:hosts": {
      "host": [
        {
          "name": "host1",
          "enabled": true,
          "numberOfServers": 2,
          "servers": {
            "server": [
              {
                "name": "serv1",
                "ip": "192.168.0.1",
                "port": 5001
              },
              {
                "name": "serv2",
                "ip": "192.168.0.1",
                "port": 5000
              }
            ]
          }
        },
        {
          "name": "host2",
          "enabled": false,
          "numberOfServers": 0
...</pre><p>
          Still working with the same data model as used in the example
          above, we might want to see the current configuration in
          keypath format. The following example shows how to do that,
          and shows the resulting output.
        </p><pre class="screen">admin@io 15:11:24&gt; show configuration hosts | display keypath
/hosts/host{host1} enabled
/hosts/host{host1}/numberOfServers 2
/hosts/host{host1}/servers/server{serv1}/ip 192.168.0.1
/hosts/host{host1}/servers/server{serv1}/port 5001
/hosts/host{host1}/servers/server{serv2}/ip 192.168.0.1
/hosts/host{host1}/servers/server{serv2}/port 5000
/hosts/host{host2} disabled
/hosts/host{host2}/numberOfServers 0</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6213"></a>16.7.&nbsp;Range expressions</h2></div></div></div><p>
        It is possible to modify a range of instances at the same
        time using range expressions, and to display a range of
        instances using a range expression.
      </p><p>
        Key attributes that are integers are automatically support
        range expressions, both in the J- style and the I- and C-
        style CLI. The syntax is slightly different in the J-style
        than in I- and C- style.
      </p><p>
        Automatic range expressions are also supported for key
        elements of other types as long as they are restricted
        to the pattern [a-zA-Z-]*[0-9]+/[0-9]+/[0-9]+/.../[0-9]+.
        I.e., the CLI understands the [integer]/[integer] syntax.
      </p><p>
        If you have more complicated data-types then you may need
        to write a custom range callback. See the
        <code class="filename">examples.confd/cli/custom_ranges</code> example.
      </p><p>
        Suppose we have data model like this:
      </p><pre class="programlisting">module range {
  namespace "http://tail-f.com/ns/example/range";
  prefix range;

  import ietf-inet-types {
    prefix inet;
  }

  import tailf-common {
    prefix tailf;
  }

  typedef interface-type {
    type string {
      pattern "((FastEthernet-)|(GigaEthernet-))[0-9]+/[0-9]+/[0-9]+";
    }
  }

  list server {
    key name;
    max-elements 64;
    leaf name {
      type int32;
    }
    leaf ip {
      type inet:ip-address;
      mandatory true;
    }
    leaf port {
      type inet:port-number;
      mandatory true;
    }
    leaf description {
      type string;
    }
  }

  list interface {
    key name;
    max-elements 64;
    leaf name {
      type interface-type;
    }
    leaf ip {
      type inet:ip-address;
      mandatory true;
    }
    leaf mtu {
      type int32;
      mandatory true;
    }
    leaf description {
      type string;
    }
    tailf:action reset {
        tailf:actionpoint reset-point;
        input {
            leaf mode {
                type string;
                mandatory true;
            }
            leaf debug {
                type empty;
            }
        }
        output {
            leaf time {
                type string;
                mandatory true;
            }
        }

    }
  }
}
</pre><p>
        Then you can do the following in the J-style CLI. Display a
        selected subset of the servers:
      </p><pre class="screen">show configuration server 1-3,5</pre><p>
        Display the configuration of a subset of the interfaces:
      </p><pre class="screen">show configuration interface FastEthernet-1/1/1,2</pre><p>
        In configure mode you can edit a range of interfaces in one
        go. For example:
      </p><pre class="screen">jb@io&gt; configure
Entering configuration mode private
[ok][2009-06-16 12:57:59]

[edit]
jb@io% edit interface FastEthernet-1/1/1-3
[ok][2009-06-16 12:58:14]

[edit interface FastEthernet-1/1/1-3]
jb@io% set mtu 1400
[ok][2009-06-16 12:58:20]

[edit interface FastEthernet-1/1/1-3]
jb@io% commit
Commit complete.
[ok][2009-06-16 12:58:22]

[edit interface FastEthernet-1/1/1-3]
jb@io%</pre><p>
        In the C- and I- style CLIs the syntax is slightly different
        in configure mode. When you want to modify a range of instances
        you enter a specific range mode.
      </p><pre class="screen">io# config
Entering configuration mode terminal
io(config)# interface range FastEthernet-1/1/1-3
io(config-interface-FastEthernet-1/1/1-3)# mtu 1300
io(config-interface-FastEthernet-1/1/1-3)# commit
Commit complete.
io(config-interface-FastEthernet-1/1/1-3)#</pre><p>
        See the <code class="filename">examples.confd/cli/ranges</code> example.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6232"></a>16.8.&nbsp;Autorendering of enabled/disabled</h2></div></div></div><p>
        If the data model contains an element called <code class="sgmltag-element">enabled</code>
        of type <span class="type">xs:boolean</span>
        then it will get some special treatment. Normally the user
        would have to enter <span class="command"><strong>enabled true</strong></span> and
        <span class="command"><strong>enabled false</strong></span> to enable/disable. To make
        this a bit more user friendly the CLI will also accept
        <span class="command"><strong>enabled</strong></span> and
        <span class="command"><strong>disabled</strong></span>. A <span class="command"><strong>disabled</strong></span>
        command will be auto generated if there
        is an <span class="command"><strong>enabled</strong></span> option of the proper type.
      </p><p>
        However, the <span class="command"><strong>disabled</strong></span> command will not be
        visible in configuration dumps, instead <span class="command"><strong>enabled
        false</strong></span> will be shown. The <span class="command"><strong>disabled</strong></span>
        command is only provided as a sugar in the CLI.
      </p><p>
        This behaviour can be controlled on a global level by configuring
        the <code class="filename">confd.conf</code> setting
        <span class="emphasis"><em>/confdConfig/cli/useShortEnabled</em></span>. If the value is
        set to 'true', it is possible to disable the behavior on a per
        leaf basis, by using the extension
        <span class="emphasis"><em>tailf:cli-suppress-shortenabled</em></span>.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6251"></a>16.9.&nbsp;Actions</h2></div></div></div><p>
        Actions are invoked differently in C/I- and J-mode. In C/I-mode
        an action appears as a mode specific command, whereas in J-mode
        an action is invoked using the <span class="command"><strong>request</strong></span> command in
        operational mode.
      </p><p>
        For example, given the data model fragment below:
      </p><pre class="programlisting">tailf:action shutdown {
  tailf:actionpoint actions;
  input {
    tailf:constant-leaf flags {
      type uint64 {
        range "1 .. max";
      }
      tailf:constant-value 42;
    }
    leaf timeout {
      type xs:duration;
      default PT60S;
    }
    leaf message {
      type string;
    }
    container options {
      leaf rebootAfterShutdown {
        type boolean;
        default false;
      }
      leaf forceFsckAfterReboot {
        type boolean;
        default false;
      }
      leaf powerOffAfterShutdown {
        type boolean;
        default true;
      }
    }
  }
}</pre><p>
        In J-mode the restart action is invoked as follows:
      </p><pre class="screen">joe@io&gt; request shutdown timeout 10s message reboot options { forceFsckAfterReboot true }</pre><p>
        And in C/I-mode as a mode specific command as follows:
      </p><pre class="screen">io(config)# system restart mode quick restore { db startup  fast } debug timeout 45</pre><p>
        Full command and argument completion is available when entering
        the command.
      </p><p>
        The order in which the action arguments are entered is not important.
        The parameters are reordered by the CLI-backend before invoking the
        action callback.
      </p><p>In the CLI the action is not paginated by default and will
      only do so if it is piped to more.</p><div class="informalexample"><pre class="programlisting">
          joe@io&gt; example_action | more
        </pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6266"></a>16.10.&nbsp;Command history</h2></div></div></div><p>
        By default, command history is maintained in each mode.
        When we enter configure mode for the first time, we will get
        an empty history, i.e. we cannot access the command history from
        operational mode. When we exit back into operational mode we will
        again have access to the command history from the preceding
        operational mode session. There is an exception to this, specifically,
        the 'confd.conf' setting 'unifiedHistory'. This
        makes the system use one single history for both modes.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6269"></a>16.11.&nbsp;Clearing history</h2></div></div></div><p>
        By default, clearing the history in one mode (for instance
        operational mode) will not the affect the history of the other mode.
        Enabling the 'confd.conf' setting 'unifiedHistory', will cause
        the 'clear history' command to clear both the operational mode session's
        history and the configuration mode's history.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6272"></a>16.12.&nbsp;Command line editing</h2></div></div></div><p>
        The default key strokes for editing the command line and moving
        around the command history are as follows. Note that it is possible
        to change these commands using the keymap clispec modification. See
        the clispec.5 man page for more details.
      </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6275"></a>16.12.1.&nbsp;Moving the cursor:</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Move the cursor back one character</span></dt><dd><p>
              Ctrl-b or Left Arrow
            </p></dd><dt><span class="term">Move the cursor back one word</span></dt><dd><p>
              Esc-b or Alt-b
            </p></dd><dt><span class="term">
            Move the cursor forward one character
          </span></dt><dd><p>
              Ctrl-f or Right Arrow
            </p></dd><dt><span class="term">
            Move the cursor forward one word
          </span></dt><dd><p>
              Esc-f or Alt-f

            </p></dd><dt><span class="term">
            Move the cursor to the beginning of the command line
          </span></dt><dd><p>
              Ctrl-a or Home
            </p></dd><dt><span class="term">
            Move the cursor to the end of the command line
          </span></dt><dd><p>
              Ctrl-e or End
            </p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6302"></a>16.12.2.&nbsp;Delete characters:</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              Delete the character before the cursor
            </span></dt><dd><p>
                Ctrl-h, Delete, or Backspace
              </p></dd><dt><span class="term">
              Delete the character following the cursor
            </span></dt><dd><p>
                Ctrl-d
              </p></dd><dt><span class="term">
              Delete all characters from the cursor to the end of
              the line
            </span></dt><dd><p>
                Ctrl-k
              </p></dd><dt><span class="term">
              Delete the whole line
            </span></dt><dd><p>
                Ctrl-u or Ctrl-x
              </p></dd><dt><span class="term">
              Delete the word before the cursor
            </span></dt><dd><p>
                Ctrl-w, Esc-Backspace, or Alt-Backspace
              </p></dd><dt><span class="term">
              Delete the word after the cursor
            </span></dt><dd><p>
                Esc-d or Alt-d
              </p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6329"></a>16.12.3.&nbsp;Insert recently deleted text:</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              Insert the most recently deleted text at the
              cursor
            </span></dt><dd><p>
                Ctrl-y
              </p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6336"></a>16.12.4.&nbsp;Display previous command lines:</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              Scroll backward through the command history
            </span></dt><dd><p>
                Ctrl-p or Up Arrow
              </p></dd><dt><span class="term">
              Scroll forward through the command history
            </span></dt><dd><p>
                Ctrl-n or Down Arrow
              </p></dd><dt><span class="term">
              Search the command history in reverse order
            </span></dt><dd><p>
                Ctrl-r
              </p></dd><dt><span class="term">
              Show a list of previous commands
            </span></dt><dd><p>
                run the "show cli history" command
              </p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6355"></a>16.12.5.&nbsp;Capitalization:</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              Capitalize the word at the cursor, i.e. make the first
              character uppercase and the rest of the word lowercase.
            </span></dt><dd><p>
                Esc-c
              </p></dd><dt><span class="term">
              Change the word at the cursor to lowercase.
            </span></dt><dd><p>
                Esc-l
              </p></dd><dt><span class="term">
              Change the word at the cursor to uppercase.
            </span></dt><dd><p>
                Esc-u
              </p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6370"></a>16.12.6.&nbsp;Special:</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              Abort a command/Clear line
            </span></dt><dd><p>
                Ctrl-c
              </p></dd><dt><span class="term">
              Quote insert character, i.e. do not treat the next keystroke
              as an edit command.
            </span></dt><dd><p>
                Ctrl-v/ESC-q
              </p></dd><dt><span class="term">
              Redraw the screen
            </span></dt><dd><p>
                Ctrl-l
              </p></dd><dt><span class="term">
              Transpose characters
            </span></dt><dd><p>
                Ctrl-t
              </p></dd><dt><span class="term">
            Enter multi-line mode. This lets you enter multi-line
            values when prompted for a value in the CLI. It is not
            available when editing a CLI command.
          </span></dt><dd><p>
              ESC-m
            </p></dd><dt><span class="term">
              Exit configuration mode. Only in C- and I-style.
            </span></dt><dd><p>
                Ctrl-z
              </p></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6397"></a>16.13.&nbsp;Using CLI completion</h2></div></div></div><p>
        We do not always have to type the full command or option
        name for the CLI to recognize it. To display possible
        completions, type the partial command followed immediately
        by &lt;tab&gt; or &lt;space&gt;.
      </p><p>
        If the partially typed command uniquely identifies a
        command, the full command name will appear. Otherwise a
        list of possible completions is displayed.
      </p><p>
        Completion is disabled inside quotes; in other words, if we want to
        type an argument containing spaces, we can either quote
        them with a \ (e.g. <span class="command"><strong>show file foo\ bar</strong></span>) or with a "
        (e.g. <span class="command"><strong>show file "foo bar"</strong></span>). Space completion is
        disabled when entering a filename.
      </p><p>
        Command completion also applies to filenames and
        directories.
      </p><p>Example:</p><pre class="screen">admin@io&gt; &lt;space&gt;
Possible completions:
commit     - Confirm a pending commit
configure  - Manipulate software configuration information
file       - Perform file operations
help       - Provide help information
monitor    - Real-time debugging
ping       - Ping a host
quit       - Exit the management session
request    - Make system-level requests
set        - Set CLI properties
set-path   - Set relative show-path
show       - Show information about the system
ssh        - Open a secure shell on another host
telnet     - Open a telnet session to another host
traceroute - Trace the route to a remote host
admin@io&gt; re&lt;space&gt;quest &lt;space&gt;
Possible completions:
job     - Job operations
message - Send message to terminal of one or all users
system  - System operations
admin@io&gt; request  m&lt;space&gt;essage all "hello"</pre><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6407"></a>16.13.1.&nbsp;Customizing CLI completion</h3></div></div></div><p>
          CLI completion kicks in for both command parameters and for
          values adhering to leaf elements in yang. By default
          completions are generated automatically depending on the
          parameter or leaf element type. Some examples:
        </p><pre class="screen">d199# history ?
&lt;size&gt;</pre><p>
          Above we trigger a ?-completion for the built-in
          <span class="command"><strong>history</strong></span> command which takes a single
          parameter of type
          <span class="emphasis"><em>xs:nonNegativeInteger</em></span>. The built-in
          history command chooses to answer with a
          <span class="emphasis"><em>&lt;size&gt;</em></span> completion string.
        </p><pre class="screen">d199# config
Entering configuration mode terminal
d199(config)# interface ?
Possible completions:
  &lt;name: GigaEthernetX/Y&gt;</pre><p>
          Above we trigger a ?-completion for the list element
          <span class="emphasis"><em>interface</em></span> which has a key leaf element of type
          <span class="emphasis"><em>interfaceNameType</em></span> defined in the
          <span class="emphasis"><em>http://tail-f.com/ns/example/config/1.0</em></span> namespace:
        </p><pre class="programlisting">  typedef interfaceNameType {
    tailf:info "GigaEthernetX/Y";
    type string;
  }
</pre><p>
        If the default completion behavior is not satisfactory
        a custom completion callback can be used instead. This holds
        true for both built-in and user defined commands as well for
        leaf elements in built-in and user defined data models.
      </p><p>
        In the following examples we redefined the completion
        behavior for the two examples above.
      </p><pre class="screen">d199# history ?
Possible completions:
  500  750  The history must be a non-negative value (preferably 500 or 750)</pre><p>
        and
      </p><pre class="screen">d199# config
Entering configuration mode terminal
d199(config)# interface ?
Possible completions:
  FastEthernet0/1   FastEthernet IEEE 802.3
  GigaEthernet0/1   GigabitEtherenet IEEE 802.3z
  GigaEthernet0/2   GigabitEtherenet IEEE 802.3z
  GigaEthernet1/1   GigabitEtherenet IEEE 802.3z
  GigaEthernet1/2   GigabitEtherenet IEEE 802.3z
d199(config)# interface GigaEthernet ?
Possible completions:
  GigaEthernet0/1  GigaEthernet0/2  GigaEthernet1/1  GigaEthernet1/2</pre><p>
        This was achieved using the following clispec fragment:
      </p><pre class="programlisting">    &lt;modifications&gt;
      &lt;simpleType namespace="" name="uint64"&gt;
        &lt;callback&gt;
          &lt;capi&gt;
            &lt;completionpoint&gt;generic-complete&lt;/completionpoint&gt;
          &lt;/capi&gt;
        &lt;/callback&gt;
      &lt;/simpleType&gt;
      &lt;simpleType namespace="http://tail-f.com/ns/example/config"
                  name="interfaceNameType"&gt;
        &lt;callback&gt;
          &lt;capi&gt;
            &lt;completionpoint&gt;ifs-complete&lt;/completionpoint&gt;
          &lt;/capi&gt;
        &lt;/callback&gt;
      &lt;/simpleType&gt;
</pre><p>
        The <span class="emphasis"><em>generic-complete</em></span> and <span class="emphasis"><em>ifs-complete</em></span>
        callbacks look like this (fragments):
      </p><pre class="programlisting">static int generic_complete(struct confd_user_info *uinfo, int cli_style,
                            char *token, int completion_char,
                            confd_hkeypath_t *kp, char *cmdpath,
                            char *cmdparam_id,
                            struct confd_qname *simpleType, char *extra) {
    char keypath[BUFSIZ] = {0};
    struct confd_completion_value values[6];
    int i = 0;


    if (strcmp(cmdpath, "history") == 0 ||
        strcmp(cmdpath, "set history") == 0) {
        values[i].type = CONFD_COMPLETION_INFO;
        values[i].value = "The history must be a non-negative value (preferably 500 or 750)";
        i++;

        values[i].type = CONFD_COMPLETION;
        values[i].value = "500";
        values[i].extra = NULL;
        i++;

        values[i].type = CONFD_COMPLETION;
        values[i].value = "750";
        values[i].extra = NULL;
        i++;
    }


    if (confd_action_reply_completion(uinfo, values, i) &lt; 0)
        confd_fatal("Failed to reply to confd\n");

    return CONFD_OK;
}


static int ifs_complete(struct confd_user_info *uinfo, int cli_style,
                        char *token, int completion_char, confd_hkeypath_t *kp,
                        char *cmdpath, char *cmdparam_id,
                        struct confd_qname *simpleType, char *extra) {
    char keypath[BUFSIZ] = {0};
    struct confd_completion_value values[6];
    int i = 0;


    if (completion_char == '?') {
        values[i].type = CONFD_COMPLETION;
        values[i].value = "GigaEthernet0/1";
        values[i].extra = "GigabitEtherenet IEEE 802.3z";
        i++;

        values[i].type = CONFD_COMPLETION;
        values[i].value = "GigaEthernet0/2";
        values[i].extra = "GigabitEtherenet IEEE 802.3z";
        i++;

        values[i].type = CONFD_COMPLETION;
        values[i].value = "GigaEthernet1/1";
        values[i].extra = "GigabitEtherenet IEEE 802.3z";
        i++;

        values[i].type = CONFD_COMPLETION;
        values[i].value = "GigaEthernet1/2";
        values[i].extra = "GigabitEtherenet IEEE 802.3z";
        i++;

        values[i].type = CONFD_COMPLETION;
        values[i].value = "FastEthernet0/1";
        values[i].extra = "FastEthernet IEEE 802.3";
        i++;
    }


    if (confd_action_reply_completion(uinfo, values, i) &lt; 0)
        confd_fatal("Failed to reply to confd\n");

    return CONFD_OK;
}
</pre><p>
          Take a look at the completion callback example which comes
          bundled with the ConfD distribution,
          i.e. <code class="filename">cli/completions</code> and read more about
          the completion callback API in the <a class="xref" href="rn02re10.html" title="confd_lib_dp"><span class="refentrytitle">confd_lib_dp</span>(3)</a> manual page.
        </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6435"></a>16.14.&nbsp;Using the comment characters # or !</h2></div></div></div><p>
        All characters following a # (in J-style) or ! (in C-style)
        character up to the next newline are
        ignored. This makes it possible to have comments in a file
        containing CLI commands, and still be able to paste the
        file into the command-line interface. For example:
      </p><pre class="programlisting"># Command file create 2006-05-20 by Joe Smith
# First show the configuration before we change it
show configuration
# Enter configuration mode and add joe as user
configure
wizard adduser
joe
foobar
foobar
admin
commit
exit
# Done</pre><p>
        If we want to enter the # or the ! character as an argument, it
        has to be prefixed with a backslash (\) or used inside
        quotes (").
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ug.cli.annotations"></a>16.15.&nbsp;Annotations and tags</h2></div></div></div><p>
      If you have large configurations it may make sense to be able to
      associate comments (annotations) and tags with the different
      parts. And then be able to filter the configuration with respect
      to the annotations or tags. For example, tagging parts of the
      configuration that relates to a certain department or customer.
    </p><p>
      ConfD has support for both tags and annotations. The support
      is enabled by enabling configuration attributes in the
      <code class="filename">confd.conf</code> file. I.e.,
    </p><pre class="programlisting">
  &lt;enableAttributes&gt;true&lt;/enableAttributes&gt;
</pre><p>
      Once attributes has been enabled a set of new commands will
      be available in the CLI for annotating and tagging parts
      of the configuration. There will also be a set of pipe targets
      for controlling whether the tags and annotations should be
      displayed, and for filtering depending on annotation and tag
      content.
    </p><p>
      The new commands are:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="command"><strong>annotate &lt;statement&gt; &lt;text&gt;</strong></span>
        </p></li><li class="listitem"><p>
          <span class="command"><strong>tag add &lt;statement&gt; &lt;tag&gt;</strong></span>
        </p></li><li class="listitem"><p>
          <span class="command"><strong>tag del &lt;statement&gt; &lt;tag&gt;</strong></span>
        </p></li><li class="listitem"><p>
          <span class="command"><strong>tag clear &lt;statement&gt; &lt;tag&gt;</strong></span>
        </p></li></ul></div><p>
      The annotations and tags will be displayed as comments where the
      tags are prefixed by <span class="command"><strong>Tags:</strong></span>. For example:
    </p><pre class="screen">
joe@io 16:10:17% annotate aaa authentication users user admin "Only allow the XX department access to this user."
[ok][2009-09-29 16:17:16]

[edit]
joe@io 16:17:16% tag add aaa authentication users user oper foo
[ok][2009-09-29 16:28:28]

[edit]
joe@io 16:29:02% show aaa authentication users user | tags foo
/* Tags: foo */
user oper {
    uid        1000;
    gid        1000;
    password   $1$mfy4jdVt$dNJbiaylcbjpNIeRvHs3X0;
    ssh_keydir /var/confd/homes/oper/.ssh;
    homedir    /var/confd/homes/oper;
}
[ok][2009-09-29 16:29:18]

[edit]
joe@io 16:29:29% show aaa authentication users user | annotation *XX*
/* Only allow the XX department access to this user. */
user admin {
    uid        1000;
    gid        1000;
    password   $1$Qe$71aKksCOyR.KTBG6ojcGg1;
    ssh_keydir /var/confd/homes/admin/.ssh;
    homedir    /var/confd/homes/admin;
}
[ok][2009-09-29 16:29:33]

[edit]
joe@io 16:29:33%
</pre><p>
      It is possible to hide the tags and annotations when viewing the
      configuration, or to explicitly include them in the listing.
      This is done using the <span class="command"><strong>display annotations/tags</strong></span>
      and <span class="command"><strong>hide annotations/tags</strong></span> pipe targets.
    </p><p>
      Note that annotations are tags are part of the configuration.
      If you add, remove or modify an annotation or tag you need to
      commit the new configuration, just as you would if you have
      made any other change to the configuration. In I-style this
      will happen automatically once you press <span class="emphasis"><em>enter</em></span>.
    </p><p>
      See the <code class="filename">examples.confd/cli/annotations</code> example
      for a hands on experience.
    </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ug.cli.inactive"></a>16.16.&nbsp;Activate and Deactivate</h2></div></div></div><p>
      It may be useful to be able to deactivate parts of a configuration
      without actually removing it from the configuration file. It makes
      it possible to, for example, pre-provision a device or temporarily
      disable parts of a configuration without loosing the config.
    </p><p>
      ConfD has support for activate/deactivate. The support
      is enabled by enabling configuration attributes in the
      <code class="filename">confd.conf</code> file. I.e.,
    </p><pre class="programlisting">
  &lt;enableInactive&gt;true&lt;/enableInactive&gt;
</pre><p>
      Once inactive has been enabled two new commands becomes
      available in configure mode: <span class="command"><strong>activate</strong></span>
      and <span class="command"><strong>deactivate</strong></span>. The argument to the
      command is a path into the configuration with the same
      properties as a path that is deletable.
    </p><p>
      The new commands are:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="command"><strong>activate &lt;statement&gt;</strong></span>
        </p></li><li class="listitem"><p>
          <span class="command"><strong>deactivate &lt;statement&gt;</strong></span>
        </p></li></ul></div><p>
      A deactivated statement will be indicated by a comment that says
      <span class="emphasis"><em>Inactive</em></span> on a line before the deactivated
      statement in C- and I-style, and by an <span class="emphasis"><em>inactive:</em></span>
      prefix in J-style.
    </p><p>In the J-style CLI</p><pre class="screen">
joe@io% deactivate server 1
[ok][2010-11-02 14:45:25]

[edit]
joe@io% show server
inactive: server 1 {
    ip   1.1.1.1;
    port 1071;
}
server 2 {
    ip   1.1.1.2;
    port 1072;
}
server 3 {
    ip   1.1.1.3;
    port 1073;
}
[ok][2010-11-02 14:45:33]

[edit]
joe@io%
</pre><p>In the C- and I-style CLIs</p><pre class="screen">
io(config)# deactivate server 1
io(config)# show config
/* Inactive */
server 1
!
io(config)# show configuration merge server
/* Inactive */
server 1
 ip   1.1.1.1
 port 1071
!
server 2
 ip   1.1.1.2
 port 1072
!
server 3
 ip   1.1.1.3
 port 1073
!
io(config)#
</pre><p>
      See the <code class="filename">examples.confd/cli/annotations</code> example
      for a hands on experience.
    </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6497"></a>16.17.&nbsp;CLI messages</h2></div></div></div><p>
        Messages appear when we enter and exit configure
        mode, when we commit a configuration, and when we type
        a command or value that is not valid.
      </p><p>Examples:</p><pre class="screen">admin@io&gt; show c
----------------^
syntax error: unknown command
Possible commands starting with c:
configuration - Display current configuration
cli           - Display cli settings
admin@io&gt; show configuration
------------------^
syntax error: unknown command
[error][2006-06-09 10:12:05]

admin@io% set aaa auth
----------------------^
syntax error: element does not exist
Possible  values starting with auth:
authentication
authorization</pre><p>
        When we commit a configuration, the CLI first validates
        the configuration and if there is a problem indicates what
        the problem is, for example a missing identifier or a
        value out of range. A message indicates where the errors are.
      </p><p>Examples:</p><pre class="screen">admin@io&gt; configure
Entering configuration mode "private"
[ok][2006-06-02 12:31:59]

[edit]
admin@io% set aaa authorization rules rule 200
[ok][2006-06-02 12:31:59]

[edit]
admin@io% commit
Aborted: value is unset 'aaa authorization rules rule 200 action'
[error][2006-06-02 12:31:59]

[edit]
admin@io%</pre></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6505"></a>16.18.&nbsp;confd.conf settings</h2></div></div></div><p>
        Parts of the CLI behavior can be controlled from the
        <code class="filename">confd.conf</code> file. See the confd.conf.5
        man page for a comprehensive description of all the options.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6509"></a>16.19.&nbsp;CLI Environment</h2></div></div></div><p>
        There are a number of session variables in the CLI. They are
        only used during the session and are not persistent. Their
        values are inspected using <span class="command"><strong>show cli</strong></span> in
        operational mode,
        and set using <span class="command"><strong>set</strong></span> in operational mode.
        Their initial values are in order derived from the content of the
        confd.conf file, and the global defaults as configured
        under /aaa:session, and finally from user specific
        settings configured under under /aaa:user{&lt;user&gt;}/setting.
      </p><pre class="screen">admin@io&gt; show cli
cli {
    autowizard true;
    complete-on-space true;
    ignore-leading-space false;
    history 100;
    idle-timeout 1800;
    output {
        file terminal;
    }
    paginate true;
    screen {
        length 82;
        width 80;
    }
    show {
        defaults false;
    }
    terminal xterm;
}
[ok][2006-06-02 12:31:59]
admin@io&gt;</pre><p>
        The different values control different parts of the CLI
        behavior.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <span class="command"><strong>autowizard</strong></span>
            (<span class="emphasis"><em>true</em></span> | <span class="emphasis"><em>false</em></span>)
          </span></dt><dd><p>
              When enabled, the CLI will prompt the user for required
              settings when a new identifier is created and for
              mandatory action parameters.
            </p><p>
              For example:
            </p><pre class="screen">admin@io% set aaa authorization rules rule 200
Value for 'context' (&lt;string&gt;): *
Value for 'path' (&lt;string&gt;): *
Value for 'group' (&lt;string&gt;): *
Value for 'op' (&lt;string&gt;): rw
Value for 'action' [reject,accept]: reject
[ok][2006-06-02 12:31:59]

[edit]
admin@io%</pre><p>
            This saves the user from typing explicit <span class="command"><strong>set</strong></span>
            commands to set each required setting.
          </p><p>
            Note that it is recommended to disable the autowizard
            before pasting in a list of commands, in order to avoid
            prompting. A good practice is to start all such scripts
            with a line that disables the autowizard:
          </p><pre class="screen">set autowizard false
...
set autowizard true</pre></dd><dt><span class="term">
            <span class="command"><strong>complete-on-space</strong></span>
            (<span class="emphasis"><em>true</em></span> | <span class="emphasis"><em>false</em></span>)
          </span></dt><dd><p>
              Controls if command completion should be attempted when
              &lt;space&gt; is entered. Entering &lt;tab&gt; always
              results in command completion.
            </p></dd><dt><span class="term">
            <span class="command"><strong>devtools</strong></span>
            (<span class="emphasis"><em>true</em></span> |
            <span class="emphasis"><em>false</em></span>)
          </span></dt><dd><p>
              Controls if certain commands that are useful for developers
              should be enabled. The commands <span class="command"><strong>xpath</strong></span> and
              <span class="command"><strong>timecmd</strong></span> are examples of such a command.
            </p></dd><dt><span class="term">
            <span class="command"><strong>ignore-leading--space</strong></span>
            (<span class="emphasis"><em>true</em></span> | <span class="emphasis"><em>false</em></span>)
          </span></dt><dd><p>
              Controls if leading spaces should be ignored or not. This
              is useful to turn off when pasting commands into the CLI.
            </p></dd><dt><span class="term">
            <span class="command"><strong>history</strong></span>
            (<span class="emphasis"><em>&lt;integer&gt;</em></span>)
          </span></dt><dd><p>
              Size of CLI command history.
            </p></dd><dt><span class="term">
            <span class="command"><strong>idle-timeout</strong></span>
            (<span class="emphasis"><em>&lt;seconds&gt;</em></span>)
          </span></dt><dd><p>
              Maximum idle time before being logged out. Use 0 (zero) for
              for infinity.
            </p></dd><dt><span class="term">
            <span class="command"><strong>paginate</strong></span>
            (<span class="emphasis"><em>true</em></span> |
            <span class="emphasis"><em>false</em></span>)
          </span></dt><dd><p>
              Some commands paginate their output, for example. This
              can be disabled or enabled. It is enabled by default.
            </p></dd><dt><span class="term">
            <span class="command"><strong>screen width</strong></span>
            (<span class="emphasis"><em>&lt;integer&gt;</em></span>)
          </span></dt><dd><p>
              Current width of terminal. This is used when paginating
              output to get proper line count.
            </p></dd><dt><span class="term">
            <span class="command"><strong>screen length</strong></span>
            (<span class="emphasis"><em>&lt;integer&gt;</em></span>)
          </span></dt><dd><p>
              Current length of terminal. This is used when paginating
              output to get proper line count.
            </p></dd><dt><span class="term">
            <span class="command"><strong>service prompt config</strong></span>
          </span></dt><dd><p>
              Controls whether a prompt should be displayed in
              configure mode in the C- and I-style CLI. If set
              to false then no prompt will be displayed. The
              setting is changed using the commands
              <span class="command"><strong>no service prompt config</strong></span>
              and <span class="command"><strong>service prompt config</strong></span>
              in configure mode.
            </p></dd><dt><span class="term">
            <span class="command"><strong>show defaults</strong></span>
            (<span class="emphasis"><em>true</em></span> | <span class="emphasis"><em>false</em></span>)
          </span></dt><dd><p>
              Controls if defaults values should be shown when
              displaying the configuration. The default values are shown
              as comments after the configured value.
            </p><p>For example:</p><pre class="screen">admin@io% show hosts host
host x15 {
    domain tail-f.com;
    defgw 10.1.5.2;
    interfaces {
        interface 1 {
            name eth0;
            ipMask {
                ip 192.68.0.60;   # 10.0.0.0
                mask 255.255.0.0;   # 255.255.0.0
            }
            enabled false;
        }
    }
}
[ok][2006-06-02 12:31:59]

[edit]
admin@io%</pre></dd><dt><span class="term">
            <span class="command"><strong>terminal</strong></span>
            (<span class="emphasis"><em>string</em></span>)
          </span></dt><dd><p>
              Terminal type. This setting is used for controlling how
              line editing is performed. Supported terminals are: dumb,
              vt100, xterm, linux, and ansi. Other terminals may also
              work but have no explicit support.
            </p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6606"></a>16.20.&nbsp;Commands in J-style</h2></div></div></div><p>
        It is possible to get a full XML listing of the commands available in
        a running ConfD instance by using the confd option --cli-j-dump
        &lt;file&gt;. The generated file is only intended for documentation
        purposes and cannot be used as input to confdc.
      </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6609"></a>16.20.1.&nbsp;Operational mode commands</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>compare startup</strong></span> [<span class="command"><strong>brief</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>
          Compare current configuration to the startup
          configuration. This command is only available when the
          system has been configured  to have a startup
          configuration. Differences will be annotated with
          <span class="command"><strong>-</strong></span> (removed) and <span class="command"><strong>+</strong></span> (added).

          With the <span class="command"><strong>brief</strong></span> option, only the actual
          diffs will be shown.
          </p></dd><dt><span class="term"><span class="command"><strong>compare file</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span> [<span class="command"><strong>brief</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>
          Compare current configuration to a configuration stored on
          file, i.e. previously saved using the <span class="command"><strong>save</strong></span> command.
          Differences will be annotated with <span class="command"><strong>-</strong></span> (removed)
          and <span class="command"><strong>+</strong></span> (added).

          With the <span class="command"><strong>brief</strong></span> option, only the actual
          diffs will be shown.
          </p></dd><dt><span class="term">
              <span class="command"><strong>configure</strong></span>
              (<span class="command"><strong>private</strong></span> |
              <span class="command"><strong>exclusive</strong></span> |
              <span class="command"><strong>shared</strong></span>)
            </span></dt><dd><p>
                Enter configure mode. The default is
                <span class="command"><strong>private</strong></span>.  The options have slightly
                different meaning depending on how the system is
                configured; with a writable running configuration,
                with a startup configuration, and with a candidate
                configuration.

              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
                    private (writable running enabled)
                  </span></dt><dd><p>
                      Edit a private copy of the running configuration, no
                      lock is taken.
                    </p></dd><dt><span class="term">
                    private (writable running disabled, startup enabled)
                  </span></dt><dd><p>
                      Edit a private copy of the startup configuration, no
                      lock is taken.
                    </p></dd><dt><span class="term">
                    exclusive (candidate enabled)
                  </span></dt><dd><p>
                      Lock the running configuration and the candidate configuration
                      and edit the candidate configuration.
                    </p></dd><dt><span class="term">
                    exclusive (candidate disabled, startup enabled)
                  </span></dt><dd><p>
                      Lock the running configuration (if enabled) and the startup
                      configuration and edit the startup configuration.
                    </p></dd><dt><span class="term">
                    shared (writable running enabled, candidate enabled)
                  </span></dt><dd><p>
                      Edit the candidate configuration without locking it.
                    </p></dd></dl></div><p>Example:</p><pre class="screen">admin@io&gt; configure private
              Entering configuration mode "private"
              [ok][2006-06-02 12:31:59]
              [edit]
              admin%</pre></dd><dt><span class="term">
              <span class="command"><strong>
                file show
              </strong></span>
              <span class="emphasis"><em>&lt;file&gt;</em></span>
            </span></dt><dd><p>
                Display contents of a <span class="emphasis"><em>&lt;file&gt;</em></span>.
              </p><p>Example:</p><pre class="screen">admin@io&gt; file show /etc/skel/.bash_profile
              # /etc/skel/.bash_profile

              # This file is sourced by bash for login shells.  The following line
              # runs our .bashrc and is recommended by the bash info pages.
              [[ -f ~/.bashrc ]] &amp;amp;&amp;amp; . ~/.bashrc
              [ok][2006-06-02 12:31:59]
              admin@io&gt;</pre></dd><dt><span class="term">
              <span class="command"><strong>
                file list
              </strong></span>
              <span class="emphasis"><em>&lt;directory&gt;</em></span>
            </span></dt><dd><p>
                List files in <span class="emphasis"><em>&lt;directory&gt;</em></span>.

              </p><p>Example:</p><pre class="screen">admin@io&gt; file list /config
              rollback0
              rollback1
              rollback2
              rollback3
              rollback4
              [ok][2006-06-02 12:31:59]
              admin@io&gt;</pre></dd><dt><span class="term">
              <span class="command"><strong>
                help
              </strong></span>
              <span class="emphasis"><em>&lt;command&gt;</em></span>
            </span></dt><dd><p>
                Display help text related to <span class="emphasis"><em>&lt;command&gt;</em></span>.
              </p><p>Example:</p><pre class="screen">admin@io&gt; help request job
              Help for command: request job
              Job operations
              [ok][2006-06-02 12:31:59]
              admin@io&gt;</pre></dd><dt><span class="term">
              <span class="command"><strong>request</strong></span>
              <span class="emphasis"><em>&lt;path&gt;</em></span>
              <span class="emphasis"><em>&lt;parameters&gt;</em></span>
            </span></dt><dd><p>
                Invokes the action found at
                <em class="parameter"><code>path</code></em> using the supplied
                <span class="emphasis"><em>parameters</em></span>. For example, given
                the following action specification in a yang file:
              </p><pre class="programlisting">tailf:action shutdown {
              tailf:actionpoint actions;
              input {
              tailf:constant-leaf flags {
              type uint64 {
              range "1 .. max";
              }
              tailf:constant-value 42;
              }
              leaf timeout {
              type xs:duration;
              default PT60S;
              }
              leaf message {
              type string;
              }
              container options {
              leaf rebootAfterShutdown {
              type boolean;
              default false;
              }
              leaf forceFsckAfterReboot {
              type boolean;
              default false;
              }
              leaf powerOffAfterShutdown {
              type boolean;
              default true;
              }
              }
              }
              }</pre><p>
                the action can be invoked in the following way
              </p><pre class="screen">admin@io&gt; request shutdown timeout 10s message reboot options { forceFsckAfterReboot true }</pre></dd><dt><span class="term">
              <span class="command"><strong>request system logout user</strong></span>
              (<span class="emphasis"><em>&lt;username&gt;</em></span> |
              <span class="emphasis"><em>&lt;sessionid&gt;</em></span>)
            </span></dt><dd><p>
                Log out a specific user or session from the device. If the
                user held the <span class="command"><strong>configure exclusive</strong></span> lock, it will be
                released.
              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
                    &lt;username&gt;
                  </span></dt><dd><p>
                      Log out a specific user.
                    </p></dd><dt><span class="term">
                    &lt;sessionid&gt;
                  </span></dt><dd><p>
                      Terminate a specific session.
                    </p></dd></dl></div><p>Example:</p><pre class="screen">admin@io&gt; show users
              SID USER  TYPE FROM      PROTO   LOGIN
              *4  admin cli  127.0.0.1 console 13:11:03
              3  oper  cli  127.0.0.1 console 13:11:01
              [ok][2006-06-02 12:31:59]
              admin@io&gt; request system logout user oper
              [ok][2006-06-02 12:31:59]
              admin@io&gt; show users
              SID USER  TYPE FROM      PROTO   LOGIN
              *4  admin cli  127.0.0.1 console 13:11:03
              [ok][2006-06-02 12:31:59]
              admin@io&gt;</pre></dd><dt><span class="term"><span class="command"><strong>request message</strong></span> (<span class="command"><strong>all</strong></span> | <span class="emphasis"><em>&lt;user&gt;</em></span>) <span class="emphasis"><em>&lt;message&gt;</em></span></span></dt><dd><p>Display a message on the screens of all users who
              are logged in to the device or on a specific screen.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>all</strong></span></span></dt><dd><p>Display the message to all currently logged
                    in users.</p></dd><dt><span class="term"><span class="emphasis"><em>&lt;user&gt;</em></span></span></dt><dd><p>Display the message to a specific user.</p></dd></dl></div><p>Example:</p><pre class="screen">admin@io&gt; request message oper "I will reboot system in 5 minutes."
              admin@io&gt;

              oper@io&gt; Message from admin@io at 13:16:41...
              I will reboot system in 5 minutes.
              EOF</pre></dd><dt><span class="term"><span class="command"><strong>request job stop</strong></span> <span class="emphasis"><em>&lt;job id&gt;</em></span></span></dt><dd><p>
          Stop a specific background job. In the default CLI the
          only command that creates background jobs is <span class="command"><strong>monitor start</strong></span>.
        </p><p>Example:</p><pre class="screen">admin@io&gt; monitor start /var/log/messages
        [ok][2006-06-02 12:31:59]
        admin@io&gt; show jobs
        JOB COMMAND
        3   monitor start /var/log/messages
        [ok][2006-06-02 12:31:59]
        admin@io&gt; request job stop 3
        [ok][2006-06-02 12:31:59]
        admin@io&gt; show jobs
        JOB COMMAND
        [ok][2006-06-02 12:31:59]
        admin@io&gt;</pre></dd><dt><span class="term"><span class="command"><strong>set</strong></span> (<span class="command"><strong>complete-on-space</strong></span> | <span class="command"><strong>ignore-leading-space</strong></span> | <span class="command"><strong>idle-timeout</strong></span>
          | <span class="command"><strong>paginate</strong></span> | <span class="command"><strong>screen length</strong></span> | <span class="command"><strong>screen width</strong></span>
          | <span class="command"><strong>terminal</strong></span> |<span class="command"><strong>autowizard</strong></span> | <span class="command"><strong>show defaults</strong></span>)
          <span class="emphasis"><em>&lt;value&gt;</em></span></span></dt><dd><p>
          Set CLI properties.
        </p><p>Example:</p><pre class="screen">admin@io&gt; set autowizard true
        [ok][2006-06-02 12:31:59]
        admin@io&gt;</pre></dd><dt><span class="term"><span class="command"><strong>set-path</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span></span></dt><dd><p>
          This commands lets you 'cd' into a status part of the
          tree. Similar to the 'edit' command in configure mode.
          </p></dd><dt><span class="term"><span class="command"><strong>show cli</strong></span></span></dt><dd><p>
          Display CLI properties.
        </p><p>Example:</p><pre class="screen">admin@io&gt; show cli
        cli {
        autowizard true;
        complete-on-space true;
        ignore-leading-space false;
        history 100;
        idle-timeout 1800;
        output {
        file terminal;
        }
        paginate true;
        screen {
        length 82;
        width 80;
        }
        show {
        defaults false;
        }
        terminal xterm;
        }
        [ok][2006-06-02 12:31:59]
        admin@io&gt;</pre></dd><dt><span class="term"><span class="command"><strong>show cli history</strong></span> [<span class="emphasis"><em>&lt;limit&gt;</em></span>]</span></dt><dd><p>
          Display CLI command history. By default the last 100
          commands are listed. The size of the history list is configured
          using the history CLI setting. If you specify a history limit,
          only the last number of commands up to that limit will be shown.
        </p><p>Example:</p><pre class="screen">admin@io&gt; show cli history
        06-19 14:34:02 -- ping router
        06-20 14:42:35 -- show configuration
        06-20 14:42:37 -- show users
        06-20 14:42:40 -- show cli history
        [ok][2006-06-20 14:42:40]
        admin@io&gt; show cli history 3
        14:42:37 -- show users
        14:42:40 -- show cli history
        14:42:46 -- show cli history 3
        [ok][2006-06-20 14:42:46]
        admin@io&gt;</pre></dd><dt><span class="term"><span class="command"><strong>show all</strong></span> [<span class="command"><strong>details</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>Display both configuration and status. By default the whole
          configuration and the whole status tree is displayed. It is
          possible to limit what
          is shown by supplying a pathfilter.
        </p><p>
          The <span class="emphasis"><em>pathfilter</em></span> may be either a path pointing to a
          specific instance, or if an instance id is omitted, the
          part following the omitted instance is treated as a
          filter.
        </p></dd><dt><span class="term"><span class="command"><strong>show configuration</strong></span> [<span class="command"><strong>details</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>Display current
          configuration. By default the whole configuration is
          displayed. It is possible to limit what is shown by
          supplying a pathfilter.
        </p><p>
          The <span class="emphasis"><em>pathfilter</em></span> may be either a path pointing to a
          specific instance, or if an instance id is omitted, the
          part following the omitted instance is treated as a
          filter.
        </p><p>Example:</p><p>

          To show the aaa settings for the admin user, you can do:
        </p><pre class="screen">admin@io&gt; show configuration aaa authentication users user admin
        uid 100;
        gid 10;
        password $1$feedbabe$nGlMYlZpQ0bzenyFOQI3L1;
        ssh_keydir /var/confd/homes/admin/.ssh;
        homedir /var/confd/homes/admin;
        [ok][2006-07-31 17:16:01]
        admin@io&gt;</pre><p>
          To show all users that have group id 10, you would omit the
          user id, and instead specify gid 10.
        </p><pre class="screen">admin@io&gt; show configuration aaa authentication users user gid 10
        user admin {
        uid 100;
        gid 10;
        password $1$feedbabe$nGlMYlZpQ0bzenyFOQI3L1;
        ssh_keydir /var/confd/homes/admin/.ssh;
        homedir /var/confd/homes/admin;
        }
        user oper {
        uid 100;
        gid 10;
        password $1$feedbabe$i2glnaB.iUj2VXh/zlq.o/;
        ssh_keydir /var/confd/homes/oper/.ssh;
        homedir /var/confd/homes/oper;
        }
        [ok][2006-07-31 17:16:56]
        admin@io&gt;</pre></dd><dt><span class="term"><span class="command"><strong>show parser dump</strong></span> <span class="emphasis"><em>&lt;command prefix&gt;</em></span></span></dt><dd><p>
          Shows all possible commands starting with <span class="emphasis"><em>command
          prefix</em></span>.
          </p></dd><dt><span class="term"><span class="command"><strong>show status</strong></span> <span class="emphasis"><em>&lt;pathfilter&gt;</em></span></span></dt><dd><p>
          Display current values of read-only nodes in the
          configuration.
          </p></dd><dt><span class="term"><span class="command"><strong>show table</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span> </span></dt><dd><p>
          This command shows the configuration as a table provided
          that <span class="emphasis"><em>path</em></span> leads to a list element.
        </p><p>Example:</p><pre class="screen">admin@io 09:42:08&gt; show table aaa authentication groups group
        NAME   GID  USERS
        ---------------------------
        admin       admin private
        oper        oper public
        [ok][2007-09-17 09:44:12]

        [edit]
        admin@io 09:44:12&gt; </pre></dd><dt><span class="term"><span class="command"><strong>show users</strong></span></span></dt><dd><p>
          Display currently logged on users. The current session,
          i.e. the session running the show status command,
          is marked with an asterisk.
        </p><p>Example:</p><pre class="screen">admin@io&gt; show users
        SID USER  TYPE FROM      PROTO   LOGIN
        *4  admin cli  127.0.0.1 console 13:11:03
        3  oper  cli  127.0.0.1 console 13:11:01
        [ok][2006-06-02 12:31:59]
        admin@io&gt;</pre></dd><dt><span class="term"><span class="command"><strong>show jobs</strong></span></span></dt><dd><p>
          Display currently running background jobs.
        </p><p>Example:</p><pre class="screen">admin@io&gt; show jobs
        JOB COMMAND
        3   monitor start /var/log/messages</pre></dd><dt><span class="term"><span class="command"><strong>show log</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span></span></dt><dd><p>
          Display contents of a log file.
        </p><p>Example:</p><pre class="screen">admin@io&gt; show log messages</pre></dd><dt><span class="term">
              <span class="command"><strong>source</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span>
            </span></dt><dd><p>
                Execute commands from &lt;file&gt; as if they had
                been entered by the user. The autowizard is disabled
                when executing commands from the file.
              </p></dd><dt><span class="term">
              <span class="command"><strong>commit</strong></span>
              (<span class="command"><strong>abort</strong></span> | <span class="command"><strong>confirm</strong></span>)
              [<span class="command"><strong>persist-id</strong></span> <span class="emphasis"><em>&lt;id&gt;</em></span>]
            </span></dt><dd><p>
                Abort or confirm a pending confirming commit. A
                pending confirming commit will also be aborted if
                the CLI session is terminated without doing
                <span class="command"><strong>commit confirm</strong></span>. The default is
                confirm.
              </p><p>
                If the confirming commit has been initiated with the
                persist option then user needs to supply the
                same token as a <span class="command"><strong>persist-id</strong></span> for the
                <span class="command"><strong>commit</strong></span> to have effect.
              </p><p>Example:</p><pre class="screen">admin@io&gt; commit abort</pre></dd><dt><span class="term">
              <span class="command"><strong>describe</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span>
            </span></dt><dd><p>
                Display detailed information about a command.
              </p><p>Example:</p><pre class="screen">admin@io&gt; describe ping
Common
    Source : clispec
    File   : commands-c.cli

Callback [os command]
    OS command  : ping
    Run as user : confd

Help
    Verify IP (ICMP) connectivity to a host.

Info
    Ping a host
              </pre></dd><dt><span class="term"><span class="command"><strong>timecmd</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>
              Time command. It measures and displays the execution time of <span class="emphasis"><em>&lt;command&gt;</em></span>.
            </p><p>
              <span class="emphasis"><em>Note that this command will only be available
              if <span class="command"><strong>devtools</strong></span> has been set to <span class="command"><strong>true</strong></span> in the CLI session settings.</em></span>
            </p><p>Example:</p><pre class="screen">io# timecmd id
user = admin(501), gid=20, groups=admin, gids=12,20,33,61,79,80,81,98,100
Command executed in 0.00 sec

[ok][2016-09-16 14:06:15]
io#</pre></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6901"></a>16.20.2.&nbsp;Configure mode commands</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              <span class="command"><strong>activate</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
            </span></dt><dd><p>
                Activate a statement that has previously been deactivated.
              </p><p>
                Only available in when the system has been configured
                with support for inactive.
              </p></dd><dt><span class="term">
              <span class="command"><strong>deactivate</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
            </span></dt><dd><p>
                Deactivate a statement in the configuration.
              </p><p>
                Only available in when the system has been configured
                with support for inactive.
              </p></dd><dt><span class="term">
              <span class="command"><strong>annotate</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
              <span class="emphasis"><em>&lt;text&gt;</em></span>
            </span></dt><dd><p>
                Associate an annotation with a given configuration statement.
                To remove an annotation leave the text empty.
              </p><p>
                Only available in when the system has been configured
                with attributes enabled.
              </p></dd><dt><span class="term">
              <span class="command"><strong>commit</strong></span>
              (<span class="command"><strong>check</strong></span> |
              <span class="command"><strong>and-quit</strong></span> |
              <span class="command"><strong>confirmed</strong></span>
              [<span class="emphasis"><em>&lt;timeout&gt;</em></span>]
              [<span class="command"><strong>persist</strong></span> <span class="emphasis"><em>&lt;token&gt;</em></span>] |
              <span class="command"><strong>to-startup</strong></span>)
              [<span class="command"><strong>comment</strong></span> <span class="emphasis"><em>&lt;text&gt;</em></span>]
              [<span class="command"><strong>label</strong></span> <span class="emphasis"><em>&lt;text&gt;</em></span>]
              [<span class="command"><strong>persist-id</strong></span> <span class="emphasis"><em>&lt;id&gt;</em></span>]
            </span></dt><dd><p>
              Commit current configuration to running.

              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">check</span></dt><dd><p>Validate current configuration.</p></dd><dt><span class="term">and-quit</span></dt><dd><p>Commit to running and quit configure mode.</p></dd><dt><span class="term">to-startup</span></dt><dd><p>
                      Commit current configuration to running and startup
                      configuration. Only available if the system is
                      configured to have a startup configuration.
                    </p></dd><dt><span class="term">confirmed</span></dt><dd><p>
                      Commits the current configuration to running
                      with a timeout.  If no <span class="command"><strong>commit
                      confirm</strong></span> command has been issued before
                      the timeout expires, then the configuration will
                      be reverted to the configuration that was active
                      before the <span class="command"><strong>commit confirmed</strong></span>
                      command was issued.

                      If no timeout is given then the confirming
                      commit will have a timeout of 10 minutes.

                      The configuration session will be terminated
                      after this command since no further editing is
                      possible.

                      Only available in <span class="command"><strong>configure
                      exclusive</strong></span> and <span class="command"><strong>configure
                      shared</strong></span> mode when the system has been
                      configured with a candidate.
                    </p><p>
                      The confirming commit will be rolled back if the
                      CLI session is terminated before confirming the
                      commit, unless the <span class="command"><strong>persist</strong></span>
                      argument is given. If the <span class="command"><strong>persist</strong></span>
                      command is given then the CLI session can be
                      terminated and a later session may confirm the
                      pending commit by supplying the persist token
                      as an argument to the <span class="command"><strong>commit</strong></span>
                      command using the <span class="command"><strong>persist-id</strong></span>
                      argument.
                    </p></dd><dt><span class="term">
                    comment <span class="emphasis"><em>&lt;text&gt;</em></span>
                  </span></dt><dd><p>
                      Associate a comment with the commit. The comment can
                      later be seen when examining rollback files.
                    </p></dd><dt><span class="term">
                    label <span class="emphasis"><em>&lt;text&gt;</em></span>
                  </span></dt><dd><p>
                      Associate a label with the commit. The label can
                      later be seen when examining rollback files.
                    </p></dd><dt><span class="term">
                    persist-id <span class="emphasis"><em>&lt;id&gt;</em></span>
                  </span></dt><dd><p>
                      If a prior confirming commit operation has been
                      performed with the <span class="command"><strong>persist</strong></span>
                      argument, then to modify the ongoing confirming
                      commit process the <span class="command"><strong>persist-id</strong></span>
                      argument needs to be supplied with the same
                      persist token. This makes it possible to, for
                      example, abort an onging <span class="emphasis"><em>persist</em></span>
                      commit, or extend the timeout.
                    </p></dd></dl></div><p>
            </p></dd><dt><span class="term">
              <span class="command"><strong>validate</strong></span>
            </span></dt><dd><p>
                Validates current configuration. This is the same operation
                as <span class="command"><strong>commit check</strong></span>.
              </p></dd><dt><span class="term">
              <span class="command"><strong>insert</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span>
            </span></dt><dd><p>
                Inserts a new element. If the element already exists
                and has the indexedView option set in the data model, then
                the old element will be renamed to element+1 and the new
                element inserted in its place.
              </p></dd><dt><span class="term">
              <span class="command"><strong>insert</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span>
              [<span class="command"><strong>first</strong></span> |
              <span class="command"><strong>last</strong></span>|
              <span class="command"><strong>before</strong></span> <span class="emphasis"><em>key</em></span>|
              <span class="command"><strong>after</strong></span> <span class="emphasis"><em>key</em></span>]
            </span></dt><dd><p>
                Insert a new element into an ordered list. The element
                can be added first, last (default), before or after
                another element.
              </p></dd><dt><span class="term"><span class="command"><strong>move</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span>[<span class="command"><strong>first</strong></span>|<span class="command"><strong>last</strong></span>|<span class="command"><strong>before</strong></span><span class="emphasis"><em>key</em></span>|<span class="command"><strong>after</strong></span><span class="emphasis"><em>key</em></span>]</span></dt><dd><p>Move an existing element to a new position in an ordered list. The element can be moved first, last (default), before or after another element.</p></dd><dt><span class="term"><span class="command"><strong>rename</strong></span> <span class="emphasis"><em>&lt;instance path&gt; &lt;new id&gt;</em></span></span></dt><dd><p>Rename an instance.</p></dd><dt><span class="term"><span class="command"><strong>delete</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span></span></dt><dd><p>Delete a data element.</p></dd><dt><span class="term"><span class="command"><strong>edit</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span></span></dt><dd><p>Edit a sub-element. Missing elements in <span class="emphasis"><em>path</em></span> will be
            created.</p></dd><dt><span class="term"><span class="command"><strong>exit</strong></span> (<span class="command"><strong>level</strong></span> | <span class="command"><strong>configuration-mode</strong></span>)</span></dt><dd><p>
              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">level</span></dt><dd><p>
                  Exit from this level. If performed on the top level, will
                  exit configure mode. This is the default if no option is
                  given.
                </p></dd><dt><span class="term">configuration-mode</span></dt><dd><p>
                  Exit from configuration mode regardless of which
                  edit level.
                </p></dd></dl></div><p>
            </p></dd><dt><span class="term"><span class="command"><strong>help</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>Shows help text for command.</p></dd><dt><span class="term"><span class="command"><strong>hide</strong></span> <span class="emphasis"><em>&lt;hide-group&gt;</em></span></span></dt><dd><p>Re-hides the elements and actions belonging to the
            hide groups. No password is required for hiding. Note that this
            command is hidden and not shown during command completion.</p></dd><dt><span class="term"><span class="command"><strong>unhide</strong></span> <span class="emphasis"><em>&lt;hide-group&gt;</em></span></span></dt><dd><p>Unhides all elements and actions belonging to the
            hide-group. You may be required to enter a password. Note that
            this command is hidden and not shown during command
            completion</p></dd><dt><span class="term"><span class="command"><strong>load</strong></span> (<span class="command"><strong>merge</strong></span> | <span class="command"><strong>replace</strong></span> | <span class="command"><strong>override</strong></span>) (<span class="emphasis"><em>&lt;file&gt;</em></span> | <span class="command"><strong>terminal</strong></span>)</span></dt><dd><p>
              Load configuration from file or terminal.
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">merge</span></dt><dd><p>
                      Merge content of file/terminal with current
                      configuration.
                    </p></dd><dt><span class="term">replace</span></dt><dd><p>
                      Replace the content of file/terminal for the
                      corresponding parts of the current configuration.
                      This is different from <code class="sgmltag-element">override</code> in the
                      that only the parts that occur in the file/terminal
                      are replace, the rest of the configuration is left
                      as is. In the case of <code class="sgmltag-element">override</code> the
                      entire configuration is deleted (with the
                      exception of hidden data) before loading the new
                      configuration from the file/terminal.

                    </p><p>
                      There currently exists a discrepancy in
                      behavior between different CLI:s and file
                      formats.

                      List nodes will be replaced for the following
                      combinations:
                      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                            Juniper CLI, XML and curly bracket format.
                          </p></li><li class="listitem"><p>
                            Cisco CLI, XML format.
                          </p></li></ul></div><p>

                      List nodes will be merged for the following
                      combination:
                      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                            Cisco CLI, curly bracket format.
                          </p></li></ul></div><p>

                    </p></dd><dt><span class="term">override</span></dt><dd><p>
                      The current configuration is deleted and a new
                      configuration is loaded from file/terminal.
                      Hidden data is not affected.
                    </p></dd></dl></div><p>
                The configuration file may contain <span class="command"><strong>replace:</strong></span> and <span class="command"><strong>delete:</strong></span>
                directives. For example if you have the configuration
              </p><pre class="programlisting">system {
    parent-mo {
        child-mo 1 {
            attr 10;
        }
        child-mo 2 {
            attr 5;
        }
    }
}</pre><p>
                and want to delete <span class="command"><strong>child-mo 2</strong></span>, you can create a configuration
                file containing either (using <span class="command"><strong>replace:</strong></span>)
              </p><pre class="programlisting">system {
    replace:
    parent-mo {
        child-mo 1 {
            attr 2;
        }
    }
}</pre><p>
                or (using <span class="command"><strong>delete:</strong></span>)
              </p><pre class="programlisting">system {
    parent-mo {
        delete:
        child-mo 2 {
            attr 5;
        }
    }
}</pre></dd><dt><span class="term"><span class="command"><strong>save</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span> [<span class="emphasis"><em>xml</em></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>Save the whole or parts of the current configuration to file.
            By the default the configuration is saved in curly bracket format.
            If the <span class="emphasis"><em>xml</em></span> argument is given then the configuration
            is saved in XML format.
            </p></dd><dt><span class="term"><span class="command"><strong>rollback</strong></span> [<span class="emphasis"><em>&lt;number&gt;</em></span>]</span></dt><dd><p>
                Return the configuration to a previously committed
                configuration. The system stores a limited number of old
                configurations. The number of old configurations to store is
                configured in the <code class="filename">confd.conf</code> file.
                If more than the configured
                number of configurations are stored, then the oldest
                configuration is removed before creating a new one.
              </p><p>
                The most recently
                committed configuration (the running configuration) is
                number 0, the next most recent 1, etc.
              </p><p>
                The files are called rollback0 - rollback<span class="emphasis"><em>X</em></span>, where
                <span class="emphasis"><em>X</em></span>
                is the maximum number of saved committed configurations.
              </p><p>Example:</p><pre class="screen">admin@io% rollback 1
[ok][2006-06-02 12:31:59]
admin@io% </pre><p>
                Note that this command is only available if rollback has been
                enabled in confd.conf.
              </p></dd><dt><span class="term"><span class="command"><strong>run</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>Run command in operational mode.</p></dd><dt><span class="term"><span class="command"><strong>set</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span> [<span class="emphasis"><em>&lt;value&gt;</em></span>]</span></dt><dd><p>
              Set a parameter. If a new identifier is created and
              <span class="command"><strong>autowizard</strong></span> is enabled, then the CLI will prompt the user for
              all mandatory sub-elements of that identifier. It will also prompt for mandatory
              action parameters.
            </p><p>
                If no <span class="emphasis"><em>&lt;value&gt;</em></span> is provided, then the CLI will prompt
                the user for the value. No echo of the entered value will
                occur if <span class="emphasis"><em>&lt;path&gt;</em></span> is an encrypted value, i.e. of the
                type <span class="emphasis"><em>tailf:md5-digest-string</em></span>,
                <span class="emphasis"><em>tailf:des3-cbc-encrypted-string</em></span>, or
                <span class="emphasis"><em>tailf:aes-cfb-128-encrypted-string</em></span> as described in confd_types(3).
              </p></dd><dt><span class="term"><span class="command"><strong>show</strong></span> [<span class="command"><strong>details</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>
              Show current configuration. The show command can be limited
              to a part of the configuration by providing a
              <span class="emphasis"><em>&lt;pathfilter&gt;</em></span>.
</p></dd><dt><span class="term"><span class="command"><strong>show parser dump</strong></span> <span class="emphasis"><em>&lt;command prefix&gt;</em></span></span></dt><dd><p>
            Shows all possible commands starting with <span class="emphasis"><em>command
            prefix</em></span>.
            </p></dd><dt><span class="term"><span class="command"><strong>compare running</strong></span> [<span class="command"><strong>brief</strong></span>]  [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>
              Compare current configuration to the running
              configuration. Differences will be annotated with <span class="command"><strong>-</strong></span> (removed)
              and <span class="command"><strong>+</strong></span> (added).

              With the <span class="emphasis"><em>brief</em></span> option, only the actual
              diffs will be shown.
            </p></dd><dt><span class="term"><span class="command"><strong>compare startup</strong></span> [<span class="command"><strong>brief</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>
              Compare current configuration to the startup
              configuration. This command is only available when the
              system has been configured  to have a startup
              configuration.

              With the <span class="command"><strong>brief</strong></span> option, only the actual
              diffs will be shown.
            </p></dd><dt><span class="term"><span class="command"><strong>compare file</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span> [<span class="command"><strong>brief</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>
              Compare current configuration to a configuration stored on
              file, i.e. previously saved using the <span class="command"><strong>save</strong></span> command.

              With the <span class="command"><strong>brief</strong></span> option, only the actual
              diffs will be shown.
            </p></dd><dt><span class="term">
                <span class="command"><strong>tag add</strong></span>
                <span class="emphasis"><em>&lt;statement&gt;</em></span>
                <span class="emphasis"><em>&lt;tag&gt;</em></span>
              </span></dt><dd><p>
                  Add a tag to a configuration statement.
                </p><p>
                  Only available in when the system has been configured
                  with attributes enabled.
                </p></dd><dt><span class="term">
                <span class="command"><strong>tag del</strong></span>
                <span class="emphasis"><em>&lt;statement&gt;</em></span>
                <span class="emphasis"><em>&lt;tag&gt;</em></span>
              </span></dt><dd><p>
                  Remove a tag from a configuration statement.
                </p><p>
                  Only available in when the system has been configured
                  with attributes enabled.
                </p></dd><dt><span class="term">
                <span class="command"><strong>tag clear</strong></span>
                <span class="emphasis"><em>&lt;statement&gt;</em></span>
              </span></dt><dd><p>
                  Remove all tags from a configuration statement.
                </p><p>
                  Only available in when the system has been configured
                  with attributes enabled.
                </p></dd><dt><span class="term"><span class="command"><strong>top</strong></span> [<span class="emphasis"><em>command</em></span>]</span></dt><dd><p>Exit to top level of configuration, or execute a command
            at the top level of the configuration.</p></dd><dt><span class="term"><span class="command"><strong>up</strong></span> [<span class="emphasis"><em>command</em></span>]</span></dt><dd><p>Exit one level of configuration, or execute a command at one
            level up.</p></dd><dt><span class="term"><span class="command"><strong>revert</strong></span></span></dt><dd><p>Copy running configuration into current configuration.</p></dd><dt><span class="term"><span class="command"><strong>status</strong></span></span></dt><dd><p>Display users currently editing the configuration.</p></dd><dt><span class="term">
              <span class="command"><strong>describe</strong></span>
              [<span class="emphasis"><em>&lt;path&gt;</em></span> |
              <span class="emphasis"><em>&lt;command&gt;</em></span>]
            </span></dt><dd><p>
                Display detailed information about a command.
                This information may for example consist of the source of the
                command (YANG, clispec or built-in), the corresponding path
                in the YANG file (in case of an auto-rendered command) and
                information regarding what callpoints, actionpoints and
                validation points that may be tied to the command.

                Due to the verbose information that may be displayed,
                it may be desirable to restrict the usage of this command by
                including it in an appropriate set of authorization rules or
                by the means of any other authorization functionality.
              </p><p>Example:</p><pre class="screen">admin@io% describe dhcp
Common
    Source          : YANG
    Module          : dhcpd
    Namespace       : http://tail-f.com/ns/example/dhcpd
    Path            : /dhcp
    Node            : container
    Exported agents : all
    Checksum        : 3c893927631cceee3700c23bb38cd050
              </pre></dd><dt><span class="term"><span class="command"><strong>xpath</strong></span> [<span class="command"><strong>ctx</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span>] (<span class="command"><strong>eval</strong></span> | <span class="command"><strong>must</strong></span> | <span class="command"><strong>when</strong></span>) <span class="emphasis"><em>&lt;expression&gt;</em></span></span></dt><dd><p>
            Evaluate an XPath expression. A context-path may be given
            to be used as the current context for the evaluation of
            the expression. If no context-path is given,
            the current sub-mode will be used as the context-path.
            The pipe command <span class="command"><strong>trace</strong></span> may be used
            to display debug/trace information during execution of the command.
          </p><p>
            <span class="emphasis"><em>Note that this command will only be available
            if <span class="command"><strong>devtools</strong></span> has been set to <span class="command"><strong>true</strong></span> in the CLI session settings.</em></span>
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
                eval
              </span></dt><dd><p>
                  Evaluate an XPath expression.
                </p></dd><dt><span class="term">
                must
              </span></dt><dd><p>
                  Evaluate the expression as a YANG <span class="emphasis"><em>must</em></span> expression.
                </p></dd><dt><span class="term">
                when
              </span></dt><dd><p>
                  Evaluate the expression as a YANG <span class="emphasis"><em>when</em></span> expression.
                </p></dd></dl></div></dd><dt><span class="term"><span class="command"><strong>timecmd</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>
              Time command. It measures and displays the execution time of <span class="emphasis"><em>&lt;command&gt;</em></span>.
            </p><p>
              <span class="emphasis"><em>Note that this command will only be available
              if <span class="command"><strong>devtools</strong></span> has been set to <span class="command"><strong>true</strong></span> in the CLI session settings.</em></span>
            </p><p>Example:</p><pre class="screen">io# timecmd status
Users currently editing the configuration:
admin console (cli from 127.0.0.1) on since 2016-09-16 14:15:29 private mode
Command executed in 0.00 sec

[ok][2016-09-16 14:16:01]

[edit]

io#</pre></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e7306"></a>16.21.&nbsp;Commands in C/I-style</h2></div></div></div><p>
        It is possible to get a full XML listing of the commands
        available in a running ConfD instance by using the confd
        option --cli-c-dump &lt;file&gt;, for C-style and --cli-i-dump
        for I-style. The generated file is only intended for
        documentation purposes and cannot be used as input to
        confdc.
      </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e7309"></a>16.21.1.&nbsp;Operational mode commands</h3></div></div></div><p>
            The IOS CLI does not have any of the commands associated with
            transactions, i.e. commit, abort, show configuration.
          </p><p>
            The IOS CLI has commands for entering and leaving
            privileged mode, settings passwords and secrets and
            assigning privilege levels to commands in EXEC mode.
          </p><p>
            The privilege information for the IOS mode is stored in
            the AAA namespace under the aaa/ios element. Note that all
            EXEC commands are available at level 15 without needing to
            specify them in the aaa-configuration.
          </p><p>
            It is possible to assign custom prompt to the different
            levels in EXEC mode. The default is for level 0 to have
            the "\h&gt; " prompt and for all other levels to have the
            "\h# " prompt.
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>compare startup</strong></span> [<span class="command"><strong>brief</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>
              Compare current configuration to the startup
              configuration. This command is only available when the
              system has been configured  to have a startup
              configuration. Differences will be annotated with
              <span class="command"><strong>-</strong></span> (removed) and <span class="command"><strong>+</strong></span> (added).

              With the <span class="command"><strong>brief</strong></span> option, only the actual
              diffs will be shown.
            </p></dd><dt><span class="term"><span class="command"><strong>compare file</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span> [<span class="command"><strong>brief</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>
              Compare current configuration to a configuration stored on
              file, i.e. previously saved using the <span class="command"><strong>save</strong></span> command.
              Differences will be annotated with <span class="command"><strong>-</strong></span> (removed)
              and <span class="command"><strong>+</strong></span> (added).

              With the <span class="command"><strong>brief</strong></span> option, only the actual
              diffs will be shown.
            </p></dd><dt><span class="term"><span class="command"><strong>config</strong></span> (<span class="command"><strong>terminal</strong></span> | <span class="command"><strong>shared</strong></span> | <span class="command"><strong>exclusive</strong></span> )</span></dt><dd><p>
              Enter configure mode. The default is <span class="command"><strong>terminal</strong></span>. The
              options have slightly different meaning depending on how the
              system is configured; with a writable running configuration,
              with a startup configuration, and with a candidate
              configuration.
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">terminal (writable running enabled)</span></dt><dd><p>
                  Edit a private copy of the running configuration, no
                  lock is taken.
                </p></dd><dt><span class="term">terminal (writable running disabled, startup enabled)</span></dt><dd><p>
                  Edit a private copy of the startup configuration, no
                  lock is taken.
                </p></dd><dt><span class="term">exclusive (candidate enabled)</span></dt><dd><p>
                  Lock the running configuration and the candidate
                  configuration and edit the candidate configuration.
                </p></dd><dt><span class="term">exclusive (candidate disabled, startup enabled)</span></dt><dd><p>
                  Lock the running configuration (if enabled) and the startup
                  configuration and edit the startup configuration.
                </p></dd><dt><span class="term">shared (writable running enabled, candidate enabled)</span></dt><dd><p>
                  Edit the candidate configuration without locking it.
                </p></dd></dl></div><p>Example:</p><pre class="screen">io# config terminal
Entering configuration mode terminal
io(config)#</pre></dd><dt><span class="term"><span class="command"><strong>enable</strong></span> (<span class="command"><strong>&lt;level&gt;</strong></span>)</span></dt><dd><p>
              Only available in IOS (i) mode.
              Enables privileged EXEC commands. The default level is 15.
              The CLI will prompt for a password if a password has
              been assigned to the level.
            </p><p>Example:</p><pre class="screen">io&gt; enable
io#</pre></dd><dt><span class="term"><span class="command"><strong>disable</strong></span> (<span class="command"><strong>&lt;level&gt;</strong></span>)</span></dt><dd><p>
              Only available in IOS (i) mode.
              Downgrade to a lower privilege level.
            </p><p>Example:</p><pre class="screen">io# disable 4
io#</pre></dd><dt><span class="term"><span class="command"><strong>file show</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span></span></dt><dd><p>
              Display contents of a <span class="emphasis"><em>&lt;file&gt;</em></span>.
            </p><p>Example:</p><pre class="screen">io# file show /etc/skel/.bash_profile
# /etc/skel/.bash_profile

# This file is sourced by bash for login shells.  The following line
# runs your .bashrc and is recommended by the bash info pages.
[[ -f ~/.bashrc ]] &amp;amp;&amp;amp; . ~/.bashrc
io# </pre></dd><dt><span class="term"><span class="command"><strong>file list</strong></span> <span class="emphasis"><em>&lt;directory&gt;</em></span></span></dt><dd><p>
              List files in <span class="emphasis"><em>&lt;directory&gt;</em></span>.
            </p><p>Example:</p><pre class="screen">io# file list /config
rollback0
rollback1
rollback2
rollback3
rollback4
io#</pre></dd><dt><span class="term"><span class="command"><strong>help</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>
              Display help text related to <span class="emphasis"><em>&lt;command&gt;</em></span>.
            </p><p>Example:</p><pre class="screen">io# help config
Help for command: config
    Manipulate software configuration information
io#</pre></dd><dt><span class="term"><span class="command"><strong>id</strong></span></span></dt><dd><p>
              Show user id information; uid, gid, and groups
            </p><p>Example:</p><pre class="screen">io# id
user = joe(1000), gid=100, groups=wheel, gids=10,100
io#</pre></dd><dt><span class="term"><span class="command"><strong>message</strong></span> (<span class="command"><strong>all</strong></span> | <span class="emphasis"><em>&lt;user&gt;</em></span>) <span class="emphasis"><em>&lt;message&gt;</em></span></span></dt><dd><p>
              Display a message on the screens of all users who are logged
              in to the device or on a specific screen.
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>all</strong></span></span></dt><dd><p>Display the message to all currently logged in users.</p></dd><dt><span class="term"><span class="emphasis"><em>&lt;user&gt;</em></span></span></dt><dd><p>Display the message to a specific user.</p></dd></dl></div><p>Example:</p><pre class="screen">io# message all "I will reboot the system in 5 minutes."
Message from joe@io at 13:26:49...
I will reboot the system in 5 minutes.
EOF
io#</pre></dd><dt><span class="term"><span class="command"><strong>job stop</strong></span> <span class="emphasis"><em>&lt;job id&gt;</em></span></span></dt><dd><p>
              Stop a specific background job. In the default C-style CLI
              there are no commands that create background jobs. Custom
              commands can be created that do this.
            </p><p>Example:</p><pre class="screen">io# show jobs
JOB COMMAND
1   monitor start /tmp/saved
io# job stop 1
io# show jobs
JOB COMMAND
io#</pre></dd><dt><span class="term"><span class="command"><strong>show cli</strong></span></span></dt><dd><p>
              Display CLI properties.
            </p><p>Example:</p><pre class="screen">io# show cli
autowizard           true
complete-on-space    true
ignore-leading-space false
history              50
idle-timeout         1800
output-file          terminal
paginate             true
screen-length        82
screen-width         80
show-defaults        false
terminal             xterm
io#
</pre></dd><dt><span class="term"><span class="command"><strong>history</strong></span> [<span class="emphasis"><em>&lt;limit&gt;</em></span>]</span></dt><dd><p>
              Display CLI command history. By default the last 100
              commands are listed. The size of the history list is
              configured using the CLI history setting. If you specify
              a history limit, only the last number of commands up to
              that limit will be shown.
            </p><p>Example:</p><pre class="screen">io# history
13:28:46 -- show jobs
13:28:53 -- job stop 1
13:29:05 -- show jobs
13:29:51 -- show
13:29:53 -- show cli
13:30:31 -- history
io#</pre></dd><dt><span class="term"><span class="command"><strong>show configuration commit list</strong></span> <span class="emphasis"><em>&lt;id&gt;</em></span></span></dt><dd><p>
            List rollback files (C-style only). Note that this command
            is only available if rollback has been enabled in
            confd.conf.</p></dd><dt><span class="term"><span class="command"><strong>show notification stream</strong></span> <span class="emphasis"><em>&lt;event stream name&gt;</em></span>
                [<span class="command"><strong>last</strong></span> <span class="emphasis"><em>&lt;number of events&gt;</em></span>]
                [<span class="command"><strong>from</strong></span> <span class="emphasis"><em>&lt;dateTime (ccyy-mm-dd|hh:mm:ss|ccyy-mm-ddThh:mm:ss)&gt;</em></span>]
                [<span class="command"><strong>to</strong></span> <span class="emphasis"><em>&lt;dateTime (ccyy-mm-dd|hh:mm:ss|ccyy-mm-ddThh:mm:ss)&gt;</em></span>]
              </span></dt><dd><p>
                  Display the last notifications in a selected stream.
                  The stream must use the builtin store and have replay enabled.
                  It is possible to limit the output by specifying the maximum number
                  of events and/or a time range.
            </p></dd><dt><span class="term"><span class="command"><strong>show parser dump</strong></span> <span class="emphasis"><em>&lt;command prefix&gt;</em></span></span></dt><dd><p>
            Shows all possible commands starting with <span class="emphasis"><em>command
            prefix</em></span>.
            </p></dd><dt><span class="term"><span class="command"><strong>show running-config</strong></span> [<span class="command"><strong>details | all</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>Display current configuration. By default the whole
            configuration is displayed. It is possible to limit what
            is shown by supplying a pathfilter. The pathfilter may
            be either a path pointing to a specific instance, or
            if an instance id is omitted, the part following the
            omitted instance is treated as a filter.
          </p><p>Example:</p><p>
            To show the aaa settings for the admin user, you can do:
            </p><pre class="screen">io# show running-config aaa authentication users user admin
aaa authentication users user admin
uid        1000
gid        100
password   $1$fB$0w68PmacQ4VmE3/M3nK3Ug==
ssh_keydir /var/confd/homes/admin/.ssh
homedir    /var/confd/homes/admin
!
io#</pre><p>
            To show all users that have group id 10, you would omit the
            user id, and instead specify gid 10.
            </p><pre class="screen">io# show running-config aaa authentication users user gid 100
aaa authentication users user admin
uid        1000
gid        100
password   $1$fB$0w68PmacQ4VmE3/M3nK3Ug==
ssh_keydir /var/confd/homes/admin/.ssh
homedir    /var/confd/homes/admin
!
aaa authentication users user oper
uid        1000
gid        100
password   $1$S6$brGZW9wSDifHoU7Rf5KSHA==
ssh_keydir /var/confd/homes/oper/.ssh
homedir    /var/confd/homes/oper
!</pre><p>
              Per default only elements that have been explicitly
              set to a value are shown. This makes it easier to
              handle large configurations. However, it is possible
              to force the show command to display all elements. This
              is done using the 'details' or 'all' options.
            </p></dd><dt><span class="term"><span class="command"><strong>show startup-config</strong></span> [<span class="command"><strong>details | all</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>
              Display the startup configuration. This command is
              only available if ConfD has been configured with a startup
              configuration. By default the whole configuration is
              displayed. It is possible to limit what is shown by
              supplying a pathfilter. The pathfilter may be either a
              path pointing to a specific instance, or if an instance id
              is omitted, the part following the omitted instance is
              treated as a filter.
            </p><p>
              Per default only elements that have been explicitly
              set to a value are shown. This makes it easier to
              handle large configurations. However, it is possible
              to force the show command to display all elements. This
              is done using the 'details' or 'all' options.
            </p></dd><dt><span class="term"><span class="command"><strong>write terminal</strong></span> [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>Display current configuration.
            </p></dd><dt><span class="term"><span class="command"><strong>copy running-config startup-config</strong></span></span></dt><dd><p>Copy running configuration to startup configuration. Only
            available when the system has been configured to have a
            startup database.
            </p></dd><dt><span class="term"><span class="command"><strong>write memory</strong></span></span></dt><dd><p>Copy running configuration to startup configuration. Only
            available when the system has been configured to have a
            startup database.
            </p></dd><dt><span class="term"><span class="command"><strong>source</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span></span></dt><dd><p>
              Execute commands from &lt;file&gt; as if they had
              been entered by the user. The autowizard is disabled
              when executing commands from the file.
            </p></dd><dt><span class="term"><span class="command"><strong>show</strong></span> <span class="emphasis"><em>&lt;pathfilter&gt;</em></span></span></dt><dd><p>
              Display current values of read-only parameters.
              If a list element is encountered then the command
              attempts to arrange the output as a table.
            </p></dd><dt><span class="term"><span class="command"><strong>who</strong></span></span></dt><dd><p>
              Display currently logged on users. The current session,
              i.e. the session running the show status command,
              is marked with an asterisk.
            </p><p>Example:</p><pre class="screen">io# who
Session User Context From      Proto   Date
*7      joe  cli     127.0.0.1 console 13:19:05
io#</pre></dd><dt><span class="term"><span class="command"><strong>logout</strong></span> (<span class="emphasis"><em>&lt;username&gt;</em></span> | <span class="emphasis"><em>&lt;sessionid&gt;</em></span>)</span></dt><dd><p>
              Terminates the current session.
            </p></dd><dt><span class="term"><span class="command"><strong>logout</strong></span> (<span class="emphasis"><em>&lt;username&gt;</em></span> | <span class="emphasis"><em>&lt;sessionid&gt;</em></span>)</span></dt><dd><p>
              Log out a specific user or session from the device. If the
              user held the <span class="command"><strong>configure exclusive</strong></span> lock, it will be
              released.
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;username&gt;</span></dt><dd><p>Log out a specific user.</p></dd><dt><span class="term">&lt;sessionid&gt;</span></dt><dd><p>Terminate a specific session.</p></dd></dl></div><p>Example:</p><pre class="screen">io# who
Session User  Context From      Proto   Date
*5      admin cli     127.0.0.1 console 10:25:46
4      jb    cli     127.0.0.1 console 10:25:37
io# logout jb
io# who
Session User  Context From      Proto   Date
*5      admin cli     127.0.0.1 console 10:25:46
io#</pre></dd><dt><span class="term"><span class="command"><strong>show jobs</strong></span></span></dt><dd><p>
              Display currently running background jobs.
</p><p>Example:</p><pre class="screen">io# show jobs
JOB COMMAND
2   monitor start /tmp/saved
io#</pre></dd><dt><span class="term"><span class="command"><strong>show log</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span></span></dt><dd><p>
              Display contents of a log file.
</p><p>Example:</p><pre class="screen">io# show log messages</pre></dd><dt><span class="term">
                <span class="command"><strong>commit</strong></span>
                (<span class="command"><strong>abort</strong></span> |
                <span class="command"><strong>confirm</strong></span>)
                [<span class="command"><strong>persist-id</strong></span> <span class="emphasis"><em>&lt;id&gt;</em></span>]
              </span></dt><dd><p>
                  Abort or confirm a pending confirming commit. A
                  pending confirming commit will also be aborted if
                  the CLI session is terminated without doing
                  <span class="command"><strong>commit confirm</strong></span>. The default is
                  confirm.
                </p><p>
                  If the confirming commit was initiated with a <span class="emphasis"><em>
                  persist</em></span> argument then the same token
                  needs to be supplied using the <span class="command"><strong>persist-id</strong></span>
                  argument to this command.
                </p><p>Example:</p><pre class="screen">io# commit abort</pre></dd><dt><span class="term">
                <span class="command"><strong>timestamp</strong></span>
                (<span class="command"><strong>enable</strong></span> |
                <span class="command"><strong>disable</strong></span>)
              </span></dt><dd><p>
                  Display a timestamp after a command has been executed.
                  The timestamp is displayed in the timezone UTC+-00:00
                  by default. A UTC offset may be configured in confd.conf.
                </p><p>Example:</p><pre class="screen">io# timestamp enable
io# config
Tue Mar  12 11:31:03.698 UTC
Entering configuration mode terminal
io(config)#</pre></dd><dt><span class="term">
                <span class="command"><strong>describe</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span>
              </span></dt><dd><p>
                  Display detailed information about a command.
                </p><p>Example:</p><pre class="screen"># describe ping
Common
    Source : clispec
    File   : commands-c.cli

Callback [os command]
    OS command  : ping
    Run as user : confd

Help
    Verify IP (ICMP) connectivity to a host.

Info
    Ping a host
                </pre></dd><dt><span class="term"><span class="command"><strong>timecmd</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>
              Time command. It measures and displays the execution time of <span class="emphasis"><em>&lt;command&gt;</em></span>.
            </p><p>
              <span class="emphasis"><em>Note that this command will only be available
              if <span class="command"><strong>devtools</strong></span> has been set to <span class="command"><strong>true</strong></span> in the CLI session settings.</em></span>
            </p><p>Example:</p><pre class="screen">io# timecmd pwd
At top level
Command executed in 0.00 sec

io#</pre></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e7631"></a>16.21.2.&nbsp;Configure mode commands</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>alias</strong></span> ( <span class="emphasis"><em>&lt;alias-name&gt;</em></span>  <span class="emphasis"><em>&lt;alias-expansion&gt;</em></span>)</span></dt><dd><p>
              Defines the alias <span class="emphasis"><em>alias-name</em></span>. It will be
              expanded to <span class="emphasis"><em>alias-expansion</em></span>.
            </p><p>
              It is possible  to define parametrised aliases, i.e. aliases
              that accepts parameters. The parameters are then expanded
              when the alias is applied.
            </p><p>
                The alias can be used anywhere on the command line.
                After a command with an alias has been entered, the expanded
                command line is displayed so that you can verify the alias value.
              </p><p>For example:</p><pre class="screen">io(config)# alias foo(a,b) "show $(a) ; show $(b)"
io(config)# alias myUser c87923
io(config)# commit
io(config)# foo(history,configuration)
io(config)# show history ; show configuration
...
io(config)# aaa authentication users user myUser
io(config)# aaa authentication users user c87923</pre><p>
                The aliases are stored persistently in cdb in the aaa namespace.
                Note that the clispec file needs to contain the following three
                entries in the modifications section:
              </p><pre class="programlisting">&lt;dropElem src="alias expansion"/&gt;
&lt;multiValue src="alias expansion"/&gt;
&lt;suppressMode src="alias "/&gt;</pre></dd><dt><span class="term">
              <span class="command"><strong>activate</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
            </span></dt><dd><p>
                Activate a statement in the configuration that has previously
                been deactivated.
              </p><p>
                Only available in when the system has been configured
                with support for inactive.
              </p></dd><dt><span class="term">
              <span class="command"><strong>deactivate</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
            </span></dt><dd><p>
                Deactivate a statement in the configuration.
              </p><p>
                Only available in when the system has been configured
                with support for inactive.
              </p></dd><dt><span class="term">
              <span class="command"><strong>annotate</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
              <span class="emphasis"><em>&lt;text&gt;</em></span>
            </span></dt><dd><p>
                Associate an annotation with a given configuration statement.
                To remove an annotation leave the text empty.
              </p><p>
                Only available in when the system has been configured
                with attributes enabled.
              </p></dd><dt><span class="term">
              <span class="command"><strong>tag add</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
              <span class="emphasis"><em>&lt;tag&gt;</em></span>
            </span></dt><dd><p>
                Add a tag to a configuration statement.
              </p><p>
                Only available in when the system has been configured
                with attributes enabled.
              </p></dd><dt><span class="term">
              <span class="command"><strong>tag del</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
              <span class="emphasis"><em>&lt;tag&gt;</em></span>
            </span></dt><dd><p>
                Remove a tag from a configuration statement.
              </p><p>
                Only available in when the system has been configured
                with attributes enabled.
              </p></dd><dt><span class="term">
              <span class="command"><strong>tag clear</strong></span>
              <span class="emphasis"><em>&lt;statement&gt;</em></span>
            </span></dt><dd><p>
                Remove all tags from a configuration statement.
              </p><p>
                Only available in when the system has been configured
                with attributes enabled.
              </p></dd><dt><span class="term"><span class="command"><strong>enable</strong></span> (<span class="command"><strong>secret | password</strong></span>) <span class="command"><strong>level</strong></span> <span class="command"><strong>&lt;level&gt;</strong></span> (<span class="command"><strong> 0 | 7</strong></span>) <span class="command"><strong>&lt;password&gt;</strong></span></span></dt><dd><p>
            Only available in IOS (i) mode.  Configures a password for
            a specific EXEC level. If both a password and a secret is
            configured, the secret is used.
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>secret | password</strong></span></span></dt><dd><p>Specifies how the password is to be encrypted</p></dd><dt><span class="term"><span class="emphasis"><em>&lt;level&gt;</em></span></span></dt><dd><p>The EXEC level to password protect</p></dd><dt><span class="term"><span class="emphasis"><em>0 | 7</em></span></span></dt><dd><p>Use 0 to indicate that the password given at the end
              of the command is in plain text, and 7 for an already
              encrypted password.</p></dd><dt><span class="term"><span class="emphasis"><em>&lt;password&gt;</em></span></span></dt><dd><p>The actual password</p></dd></dl></div><p>Example:</p><pre class="screen">io(config)# enable secret level 3 0 bluebox
io(config)#</pre></dd><dt><span class="term"><span class="command"><strong>privilege</strong></span> <span class="command"><strong>&lt;mode&gt;</strong></span> <span class="command"><strong>level</strong></span> <span class="command"><strong>&lt;level&gt;</strong></span> <span class="command"><strong>&lt;command&gt;</strong></span></span></dt><dd><p>
            Only available in IOS (i) mode.  Configures for which level
            a command should be available.
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>&lt;mode&gt;</strong></span></span></dt><dd><p>In which mode is the command.</p></dd><dt><span class="term"><span class="emphasis"><em>&lt;level&gt;</em></span></span></dt><dd><p>In which privilege level should the command be available</p></dd><dt><span class="term"><span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>Command string.</p></dd></dl></div><p>Example:</p><pre class="screen">io(config)# privilege exec level 4 show
io(config)# </pre></dd><dt><span class="term"><span class="command"><strong>hide</strong></span> <span class="emphasis"><em>&lt;hide-group&gt;</em></span></span></dt><dd><p>Re-hides the elements and actions belonging to the
          hide groups. No password is required for hiding. Note that this
          command is hidden and not shown during command completion.</p></dd><dt><span class="term"><span class="command"><strong>unhide</strong></span> <span class="emphasis"><em>&lt;hide-group&gt;</em></span></span></dt><dd><p>Unhides all elements and actions belonging to the
          hide-group. You may be required to enter a password. Note that
          this command is hidden and not shown during command
          completion</p></dd><dt><span class="term">
              <span class="command"><strong>commit</strong></span>
              (<span class="command"><strong>check</strong></span> |
              <span class="command"><strong>and-quit</strong></span> |
              <span class="command"><strong>confirmed</strong></span>
              [<span class="emphasis"><em>&lt;timeout&gt;</em></span>]
              [<span class="command"><strong>persist</strong></span> <span class="emphasis"><em>&lt;token&gt;</em></span>]
              <span class="command"><strong>to-startup</strong></span>)
              [<span class="command"><strong>comment</strong></span> <span class="emphasis"><em>&lt;text&gt;</em></span>]
              [<span class="command"><strong>label</strong></span> <span class="emphasis"><em>&lt;text&gt;</em></span>]
              [<span class="command"><strong>persist-id</strong></span> <span class="emphasis"><em>&lt;id&gt;</em></span>]
            </span></dt><dd><p>
            Commit current configuration to running.

            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">check</span></dt><dd><p>
                  Validate current configuration.
                </p></dd><dt><span class="term">and-quit</span></dt><dd><p>Commit to running and quit configure mode.</p></dd><dt><span class="term">to-startup</span></dt><dd><p>
                Commit current configuration to running and startup
                configuration. Only available if the system is
                configured to have a startup configuration.
              </p></dd><dt><span class="term">confirmed</span></dt><dd><p>
                    Commits the current configuration to running with
                    a timeout.  If no <span class="command"><strong>commit
                    confirm</strong></span> command has been issued before
                    the timeout expires, then the configuration will
                    be reverted to the configuration that was active
                    before the <span class="command"><strong>commit confirmed</strong></span>
                    command was issued.

                    If no timeout is given then the confirming commit
                    will have a timeout of 10 minutes.

                    The configuration session will be terminated after
                    this command since no further editing is possible.

                    Only available in <span class="command"><strong>configure
                    exclusive</strong></span> and <span class="command"><strong>configure
                    shared</strong></span> mode when the system has been
                    configured with a candidate.
                  </p><p>
                    The confirming commit will be rolled back if the
                    CLI session is terminated before confirming the
                    commit, unless the <span class="command"><strong>persist</strong></span>
                    argument is given. If the <span class="command"><strong>persist</strong></span>
                    command is given then the CLI session can be
                    terminated and a later session may confirm the
                    pending commit by supplying the persist token
                    as an argument to the <span class="command"><strong>commit</strong></span>
                    command using the <span class="command"><strong>persist-id</strong></span>
                    argument.
                  </p></dd><dt><span class="term">
                  comment <span class="emphasis"><em>&lt;text&gt;</em></span>
                </span></dt><dd><p>
                    Associate a comment with the commit. The comment can
                    later be seen when examining rollback files.
                  </p></dd><dt><span class="term">
                  label <span class="emphasis"><em>&lt;text&gt;</em></span>
                </span></dt><dd><p>
                    Associate a label with the commit. The label can
                    later be seen when examining rollback files.
                  </p></dd><dt><span class="term">
                  persist-id <span class="emphasis"><em>&lt;id&gt;</em></span>
                </span></dt><dd><p>
                    If a prior confirming commit operation has been
                    performed with the <span class="command"><strong>persist</strong></span>
                    argument, then to modify the ongoing confirming
                    commit process the <span class="command"><strong>persist-id</strong></span>
                    argument needs to be supplied with the same
                    persist token. This makes it possible to, for
                    example, abort an onging <span class="emphasis"><em>persist</em></span>
                    commit, or extend the timeout.
                  </p></dd></dl></div><p>
          </p></dd><dt><span class="term"><span class="command"><strong>validate</strong></span></span></dt><dd><p>Validates current configuration. This is the same operation
          as <span class="command"><strong>commit check</strong></span>.</p></dd><dt><span class="term"><span class="command"><strong>insert</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span></span></dt><dd><p>Inserts a new element. If the element already exists
          and has the indexedView option set in the data model, then
          the old element will be renamed to element+1 and the new
          element inserted in its place.</p></dd><dt><span class="term"><span class="command"><strong>insert</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span>[<span class="command"><strong>first</strong></span>|<span class="command"><strong>last</strong></span>|<span class="command"><strong>before</strong></span><span class="emphasis"><em>key</em></span>|<span class="command"><strong>after</strong></span><span class="emphasis"><em>key</em></span>]</span></dt><dd><p>Insert a new element into an ordered list. The element can be added first, last (default), before or after another element.</p></dd><dt><span class="term"><span class="command"><strong>move</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span>[<span class="command"><strong>first</strong></span>|<span class="command"><strong>last</strong></span>|<span class="command"><strong>before</strong></span><span class="emphasis"><em>key</em></span>|<span class="command"><strong>after</strong></span><span class="emphasis"><em>key</em></span>]</span></dt><dd><p>Move an existing element to a new position in an ordered list. The element can be moved first, last (default), before or after another element.</p></dd><dt><span class="term"><span class="command"><strong>rename</strong></span> <span class="emphasis"><em>&lt;instance path&gt; &lt;new id&gt;</em></span></span></dt><dd><p>Rename an instance.</p></dd><dt><span class="term"><span class="command"><strong>no</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span></span></dt><dd><p>Delete or unsets a data element.</p></dd><dt><span class="term"><span class="command"><strong>exit</strong></span> (<span class="command"><strong>level</strong></span> | <span class="command"><strong>configuration-mode</strong></span>)</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">level</span></dt><dd><p>
                Exit from current mode. If performed on the top level, will
                exit configure mode. This is the default if no option is
                given.
              </p></dd><dt><span class="term">configuration-mode</span></dt><dd><p>
                Exit from configuration mode regardless of mode.
              </p></dd></dl></div></dd><dt><span class="term"><span class="command"><strong>help</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>Shows help text for command.</p></dd><dt><span class="term"><span class="command"><strong>load</strong></span> (<span class="emphasis"><em>&lt;file&gt;</em></span> )</span></dt><dd><p>
            Load configuration from file.
          </p></dd><dt><span class="term"><span class="command"><strong>pwd</strong></span></span></dt><dd><p>
            Display current submode path.
          </p></dd><dt><span class="term"><span class="command"><strong>save</strong></span> <span class="emphasis"><em>&lt;file&gt;</em></span> [<span class="emphasis"><em>xml</em></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>] </span></dt><dd><p>Save the whole or parts of the current configuration to file.</p></dd><dt><span class="term"><span class="command"><strong>rollback configuration</strong></span> [<span class="emphasis"><em>&lt;number&gt;</em></span>]</span></dt><dd><p>
              Return the configuration to a previously committed
              configuration. The system stores a limited number of old
              configurations. The number of old configurations to store is
              configured in the confd.conf file. If more than the configured
              number of configurations are stored, then the oldest
              configuration is removed before creating a new one.
            </p><p>
              The most recently
              committed configuration (the running configuration) is
              number 0, the next most recent 1, etc.
            </p><p>
              The files are called rollback0 - rollback<span class="emphasis"><em>X</em></span>, where
              <span class="emphasis"><em>X</em></span>
              is the maximum number of saved committed configurations.
            </p><p>Example:</p><pre class="screen">io(config)# rollback configuration 1
io# </pre><p>
              Note that this command is only available if rollback has been
              enabled in confd.conf.
            </p></dd><dt><span class="term"><span class="command"><strong>do</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>Run command in operational mode.</p></dd><dt><span class="term"><span class="command"><strong>show configuration</strong></span> [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>
            Show current configuration buffer. The show command can be limited
            to a part of the configuration by providing a
            <span class="emphasis"><em>&lt;pathfilter&gt;</em></span>.
          </p></dd><dt><span class="term"><span class="command"><strong>show configuration diff</strong></span> [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>
            Show configuration changes in diff style, ie new lines prefixed
            with a plus (+) sign, and removed lines prefixed with a minus
            (-) sign.. The show command can be limited
            <span class="emphasis"><em>&lt;pathfilter&gt;</em></span>.
          </p></dd><dt><span class="term"><span class="command"><strong>show configuration commit changes</strong></span> <span class="emphasis"><em>&lt;id&gt;</em></span></span></dt><dd><p>
            Show changes that were committed for a given commit <span class="emphasis"><em>id</em></span>.
          </p></dd><dt><span class="term"><span class="command"><strong>show configuration commit list</strong></span> <span class="emphasis"><em>&lt;id&gt;</em></span></span></dt><dd><p>
            List rollback files (C-style only). Note that this command
            is only available if rollback has been enabled in
            confd.conf.</p></dd><dt><span class="term"><span class="command"><strong>show configuration rollback changes</strong></span> <span class="emphasis"><em>&lt;nr&gt;</em></span></span></dt><dd><p>
            Show changes for rolling back to rollback file <span class="emphasis"><em>nr</em></span>.
          </p></dd><dt><span class="term"><span class="command"><strong>show full-configuration</strong></span> [<span class="command"><strong>details</strong></span>] [<span class="emphasis"><em>&lt;pathfilter&gt;</em></span>]</span></dt><dd><p>
            Show current configuration. The show command can be limited
            to a part of the configuration by providing a
            <span class="emphasis"><em>&lt;pathfilter&gt;</em></span>.
          </p></dd><dt><span class="term"><span class="command"><strong>show parser dump</strong></span> <span class="emphasis"><em>&lt;command prefix&gt;</em></span></span></dt><dd><p>
            Shows all possible commands starting with <span class="emphasis"><em>command
            prefix</em></span>.
            </p></dd><dt><span class="term"><span class="command"><strong>revert</strong></span></span></dt><dd><p>Copy running configuration into current configuration.</p></dd><dt><span class="term"><span class="command"><strong>clear</strong></span></span></dt><dd><p>Remove all configuration changes.</p></dd><dt><span class="term">
              <span class="command"><strong>describe</strong></span>
              [<span class="emphasis"><em>&lt;path&gt;</em></span> |
              <span class="emphasis"><em>&lt;command&gt;</em></span>]
            </span></dt><dd><p>
                Display detailed information about a command.
                This information may for example consist of the source of the
                command (YANG, clispec or built-in), the corresponding path
                in the YANG file (in case of an auto-rendered command) and
                information regarding what callpoints, actionpoints and
                validation points that may be tied to the command.

                Due to the verbose information that may be displayed,
                it may be desirable to restrict the usage of this command by
                including it in an appropriate set of authorization rules or
                by the means of any other authorization functionality.
              </p><p>Example:</p><pre class="screen">(config)# describe dhcp
Common
    Source          : YANG
    Module          : dhcpd
    Namespace       : http://tail-f.com/ns/example/dhcpd
    Path            : /dhcp
    Node            : container
    Exported agents : all
    Checksum        : 3c893927631cceee3700c23bb38cd050
              </pre></dd><dt><span class="term"><span class="command"><strong>xpath</strong></span> [<span class="command"><strong>ctx</strong></span> <span class="emphasis"><em>&lt;path&gt;</em></span>] (<span class="command"><strong>eval</strong></span> | <span class="command"><strong>must</strong></span> | <span class="command"><strong>when</strong></span>) <span class="emphasis"><em>&lt;expression&gt;</em></span></span></dt><dd><p>
            Evaluate an XPath expression. A context-path may be given
            to be used as the current context for the evaluation of
            the expression. If no context-path is given,
            the current sub-mode will be used as the context-path.
            The pipe command <span class="command"><strong>trace</strong></span> may be used
            to display debug/trace information during execution of the command
          </p><p>
            <span class="emphasis"><em>Note that this command will only be available
            if <span class="command"><strong>devtools</strong></span> has been set to <span class="command"><strong>true</strong></span> in the CLI session settings.</em></span>
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
                eval
              </span></dt><dd><p>
                  Evaluate an XPath expression.
                </p></dd><dt><span class="term">
                must
              </span></dt><dd><p>
                  Evaluate the expression as a YANG <span class="emphasis"><em>must</em></span> expression.
                </p></dd><dt><span class="term">
                when
              </span></dt><dd><p>
                  Evaluate the expression as a YANG <span class="emphasis"><em>when</em></span> expression.
                </p></dd></dl></div></dd><dt><span class="term"><span class="command"><strong>timecmd</strong></span> <span class="emphasis"><em>&lt;command&gt;</em></span></span></dt><dd><p>
              Time command. It measures and displays the execution time of <span class="emphasis"><em>&lt;command&gt;</em></span>.
            </p><p>
              <span class="emphasis"><em>Note that this command will only be available
              if <span class="command"><strong>devtools</strong></span> has been set to <span class="command"><strong>true</strong></span> in the CLI session settings.</em></span>
            </p><p>Example:</p><pre class="screen">io# timecmd pwd
At top level
Command executed in 0.00 sec

io#</pre></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e8047"></a>16.22.&nbsp;Customizing the CLI</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8049"></a>16.22.1.&nbsp;Modifying builtin commands</h3></div></div></div><p>
          There are a number of built-in commands in each CLI style.
          These can be modified in a number of ways. It is possible to
          remove them, rename them, hide them, change their help and
          info texts, add a command timeout and to add confirmation
          prompts. This is done using the <span class="emphasis"><em>&lt;modifications&gt;</em></span>
          section of the <span class="emphasis"><em>clispec</em></span> file. For example:
          </p><pre class="programlisting">&lt;modifications&gt;
  &lt;confirmText src="configure"&gt;
    Are your really sure you know what you are doing?
  &lt;/confirmText&gt;
  &lt;delete src="request system logout"/&gt;
  &lt;delete src="show log"/&gt;
  &lt;help src="configure private"&gt;
    Enter private configuration mode.
  &lt;/help&gt;
  &lt;info src="configure"&gt;Hi there info configure!&lt;/info&gt;
  &lt;help src="configure"&gt;Hi there help configure!&lt;/help&gt;
  &lt;timeout src="show configuration"&gt;
  10
  &lt;/timeout&gt; --&gt;
&lt;/modifications&gt;</pre><p>
          See the <span class="emphasis"><em>clispec.5</em></span> man page for a detailed
          description of each modifications option.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8057"></a>16.22.2.&nbsp;Adding new commands</h3></div></div></div><p>
          New commands can be added in two different ways, either as
          an action in the <span class="emphasis"><em>YANG</em></span> file, or as a
          command in the <span class="emphasis"><em>clispec</em></span> file.  The
          advantage of using an action is that the command will be
          available through all northbound interfaces. However, a
          clispec command may give you better control over your input
          parameters.
          </p><p>
          It is also possible to use a dedicated data model for the CLI, i.e.
          a YANG file that is only visible (exported) in the CLI. This
          is useful if you want to add custom modes in the C- and I-style CLIs.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8063"></a>16.22.3.&nbsp;Suppressing automatically generated modes</h3></div></div></div><p>
          The C- and I- style CLIs will automatically create new modes for
          all list elements in the configuration, i.e. all elements that
          have <span class="emphasis"><em>maxOccurs</em></span> larger than 1.
          </p><p>
          It is possible to suppress this behavior by adding a
          <span class="emphasis"><em>suppressMode</em></span> direction in the modifications section
          of the clispec file.
          </p><p>
          For example:
          </p><pre class="programlisting">&lt;modifications&gt;
  &lt;suppressMode src="config hosts host"/&gt;
&lt;/modifications&gt;</pre><p>
          The <span class="emphasis"><em>src</em></span> attribute is the clispec path as it appears
          in the CLI. It should be the path to a list element.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8073"></a>16.22.4.&nbsp;Creating new configuration modes</h3></div></div></div><p>
          Similarly to suppressing an automatically generated mode it
          is sometimes desirable to create modes at points in the
          configuration where there isn't a list element. This can be
          done trough a declaration in the <span class="emphasis"><em>modifications</em></span>
          section of the clispec file.
          </p><p>
          For example:
          </p><pre class="programlisting">&lt;modifications&gt;
  &lt;addMode src="config hosts"/&gt;
&lt;/modifications&gt;</pre><p>
          The <span class="emphasis"><em>src</em></span> attribute should be a path to a
          static/internal element, i.e. an element with <span class="emphasis"><em>minOccurs="1"
          maxOccurs="1"</em></span>.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8082"></a>16.22.5.&nbsp;Custom mode names</h3></div></div></div><p>
            ConfD automatically assigns a mode name based on the element
            name and the key elements of the container. There are
            two styles, <span class="emphasis"><em>full</em></span> and <span class="emphasis"><em>short</em></span>, where the
            <span class="emphasis"><em>short</em></span> style only contains the last element of the
            path and the <span class="emphasis"><em>full</em></span> all components of the path.
            Which style to use is configured in the confd.conf file.
          </p><p>
            The automatic mode name can be
            overridden either by a fixed mode name or by a dynamically
            generated mode name. It is done through a <span class="emphasis"><em>modeName</em></span>
            declaration in the <span class="emphasis"><em>modifications</em></span> section of the
            clispec file.
          </p><p>
            For example:
          </p><pre class="programlisting">&lt;modifications&gt;
  &lt;modeName src="config hosts"&gt;
    &lt;fixed&gt;hosts&lt;/fixed&gt;
  &lt;/modeName&gt;
  &lt;modeName src="config hosts host interfaces interface"&gt;
    &lt;capi&gt;&lt;cmdpoint&gt;custommode&lt;/cmdpoint&gt;&lt;/capi&gt;
  &lt;/modeName&gt;
&lt;/modifications&gt;</pre><p>
            ConfD will invoke the cmdpoint/action <span class="emphasis"><em>custommode</em></span>
            the first time the mode is entered for a given instance. It
            will then cache the mode name. The callback will receive the
            path to the instance as argv/argc arguments and is expected
            to reply by calling the function
            confd_action_reply_command().
          </p><p>
            An example from <code class="filename">actions.c</code> in the
            <code class="filename">cli/c_cli</code> example:
          </p><pre class="programlisting">static int do_modename(struct confd_user_info *uinfo,
                       char *path, int argc, char **argv)
{
    int i;
    int sock;
    char *mode = "config-priv";

    printf("do_modename called\n");

    printf("path: %s\n", path);
    for (i = 0; i &lt; argc; i++) {
        printf("param %2d: %s\n", i, argv[i]);
    }

    if (confd_action_reply_command(uinfo, &amp;amp;mode, 1) &lt; 0)
        confd_fatal("Failed to reply to confd\n");

    return CONFD_OK;
}</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8100"></a>16.22.6.&nbsp;Adding custom show output</h3></div></div></div><p>
          It is possible to override the default output from the
          auto-rendered show commands but not for the J-style 'show
          configuration', 'show status', 'show all', and 'show
          table'. It can be done in two different ways. Either using a
          <span class="emphasis"><em>show</em></span> element in the clispec file or as
          a regular CLI command.
          </p><p>
          For example:
          </p><pre class="programlisting">&lt;show path="aaa authentication users user"&gt;
  &lt;callback&gt;
    &lt;exec&gt;
      &lt;osCommand&gt;./aaa_auth.sh&lt;/osCommand&gt;
    &lt;/exec&gt;
  &lt;/callback&gt;
&lt;/show&gt;</pre><p>
          The aaa_auth.sh executable will be invoked whenever the user
          enters "show aaa authentication users user" or a path
          prefix. The command will receive the indent depth and path
          as arguments.  The callback can be either a C-function
          (capi), or an executable, and it will be invoked as an
          ordinary CLI command.
          </p><p>
          It is also possible to create an ordinary CLI command and mount
          it on the same path as the show command target.
          </p><p>
          For example:
          </p><pre class="programlisting">&lt;cmd name="group" mount="show aaa authentication groups"&gt;
  &lt;help&gt;&lt;/help&gt;
  &lt;info&gt;&lt;/info&gt;
  &lt;callback&gt;
    &lt;exec&gt;
      &lt;osCommand&gt;./aaa_group.sh&lt;/osCommand&gt;
    &lt;/exec&gt;
  &lt;/callback&gt;
&lt;/cmd&gt; </pre><p>
          The advantage with this approach is that the command may take
          additional parameters, for example 'details' or 'statistics'.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8111"></a>16.22.7.&nbsp;Command parameters</h3></div></div></div><p>
            A custom CLI command can be defined to have a set of parameters.
            These parameters can be arranged as a mix of:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>a straight list of command options</p></li><li class="listitem"><p>a parameter tree</p></li><li class="listitem"><p>a choice list of parameters, where a minimum and
              maximum number of required parameters can be
              specified</p></li></ul></div><p>
          </p><p>
            Suppose you want a command that accepts a number of options in
            an arbitrary order. For example:
          </p><pre class="screen">show alarm [type &lt;type&gt;] [severity &lt;minor|major&gt;] [acknowledged] [active]</pre><p>
            The parameters can be entered in arbitrary order and they
            are all optional.  This can be achieved with a choice
            params list with min and max set.
          </p><pre class="programlisting">&lt;params mode="choice" min="0" max="4"&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;name&gt;type&lt;/name&gt;
    &lt;prefix&gt;--type &lt;/prefix&gt;
  &lt;/param&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;name&gt;severity&lt;/name&gt;
    &lt;type&gt;&lt;enums&gt;major minor&lt;/enums&gt;&lt;/type&gt;
    &lt;prefix&gt;--severity &lt;/prefix&gt;
  &lt;/param&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;type&gt;&lt;enums&gt;acknowledged&lt;/enums&gt;&lt;/type&gt;
    &lt;prefix&gt;--acknowledged&lt;/prefix&gt;
  &lt;/param&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;type&gt;&lt;enums&gt;active&lt;/enums&gt;&lt;/type&gt;
    &lt;prefix&gt;--active&lt;/prefix&gt;
  &lt;/param&gt;
&lt;/params&gt;</pre><p>
            Suppose instead that you want the following command:
          </p><pre class="screen">show alarm [type &lt;type&gt; severity &lt;minor|major&gt;] [acknowledged] [active]</pre><p>
            That is, if you enter <span class="emphasis"><em>type</em></span> you must also enter
            <span class="emphasis"><em>severity</em></span>. You can specify this with a parameter
            tree where <span class="emphasis"><em>severity</em></span> is a child to the
            <span class="emphasis"><em>type</em></span> parameter.
          </p><pre class="programlisting">&lt;params mode="choice" min="0" max="3"&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;name&gt;type&lt;/name&gt;
    &lt;prefix&gt;--type &lt;/prefix&gt;
    &lt;params&gt;
      &lt;param&gt;
        &lt;info/&gt;&lt;help/&gt;
        &lt;name&gt;severity&lt;/name&gt;
        &lt;type&gt;&lt;enums&gt;major minor&lt;/enums&gt;&lt;/type&gt;
        &lt;prefix&gt;--severity &lt;/prefix&gt;
      &lt;/param&gt;
    &lt;/params&gt;
  &lt;/param&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;type&gt;&lt;enums&gt;acknowledged&lt;/enums&gt;&lt;/type&gt;
    &lt;prefix&gt;--acknowledged&lt;/prefix&gt;
  &lt;/param&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;type&gt;&lt;enums&gt;active&lt;/enums&gt;&lt;/type&gt;
    &lt;prefix&gt;--active&lt;/prefix&gt;
  &lt;/param&gt;
&lt;/params&gt;</pre><p>
            You can have nested params lists where some are of choice mode and
            others are straight lists. However, in a choice list there cannot
            be two possible paths given a token, i.e., you cannot have two items
            that have the same name, or one named item and one that accepts
            a generic value. All paths must be deterministic.
          </p><p>
            For example, you cannot have the following command parameters:
          </p><pre class="programlisting">&lt;params mode="choice" min="0" max="2"&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;prefix&gt;--type &lt;/prefix&gt;
  &lt;/param&gt;
  &lt;param&gt;
    &lt;info/&gt;&lt;help/&gt;
    &lt;type&gt;&lt;enums&gt;major minor&lt;/enums&gt;&lt;/type&gt;
    &lt;prefix&gt;--severity &lt;/prefix&gt;
  &lt;/param&gt;
&lt;/params&gt;
</pre><p>
            The reason is that if you enter the parameter major, then
            the CLI parser cannot determine if it is intended as the
            first parameter or the second. The first parameter accepts
            any input.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8137"></a>16.22.8.&nbsp;Hiding parts of the configuration</h3></div></div></div><p>
            It is possible to hide parts of the configuration using the hidden
            attribute in the yang files, and the hideGroup attribute
            in the clispec file. All elements with the same
            hidden attribute belong to the same 'hide group'
          </p><p>
            For example (yang):
          </p><pre class="programlisting">leaf resetuser {
  tailf:hidden debug;
  type boolean;
  default false;
}</pre><p>
            For example (clispec):
          </p><pre class="programlisting">&lt;cmd name="test"&gt;
  &lt;help/&gt;
  &lt;info/&gt;
  &lt;callback&gt;
    &lt;exec&gt;
      &lt;osCommand&gt;
        test.sh
      &lt;/osCommand&gt;
    &lt;/exec&gt;
  &lt;/callback&gt;
  &lt;options&gt;
    &lt;hideGroup&gt;debug&lt;/hideGroup&gt;
  &lt;/options&gt;
&lt;/cmd&gt;</pre><p>
            In the yang example the <span class="emphasis"><em>resetuser</em></span> leaf
            belongs to the <span class="emphasis"><em>debug</em></span> hide group. All hidden
            yang elements must have default values or be optional
            since they cannot be configured by the user unless they
            have been unhidden.
          </p><p>
            Elements hidden in this way will be hidden to users when
            using the Web UI or the CLI, but can optionally be made
            visible, i.e. unhidden, through a hidden CLI command. An
            entry in the confd.conf file is needed to make this
            possible.
          </p><p>
            For example:
          </p><pre class="programlisting">&lt;hideGroup&gt;
  &lt;name&gt;debug&lt;/name&gt;
  &lt;password&gt;verysecret&lt;/password&gt;
&lt;/hideGroup&gt;</pre><p>
            The debug hide group can be 'unhidden' in the CLI provided
            that the user knows the name of the hide group and the
            password. It is possible to leave out the password
            parameter in which case the CLI will not prompt for
            one. The <span class="emphasis"><em>unhide</em></span> and <span class="emphasis"><em>hide</em></span> commands are
            used to interactively hide and unhide hide groups in the
            CLI.
          </p><p>
            It is also possible to define a C-callback that is used
            to authenticate the user. This is useful when you want
            short lived 'unhide' password, or user-specific
            unhide password.
          </p><p>
            Note that CLI commands and actions can also be hidden in
            the same way, but not individual action parameters. Also,
            hidden elements are only hidden from the CLI and the Web UI
            unless the special hide group <span class="emphasis"><em>full</em></span> is used, in
            which case it is hidden from all northbound interfaces as
            well as the rollback file.
          </p><p>
            The special hide groups <span class="emphasis"><em>full</em></span> is useful when the
            data is only used by the application and should not be
            part of the actual configuration of the device.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8158"></a>16.22.9.&nbsp;EXEC commands</h3></div></div></div><p>
            The I-style style has an additional concept of privilege
            levels. Only a subset of commands are initially available
            when the user logs on to the box. It is then possible to
            enable a higher privilege level using the <span class="emphasis"><em>enable</em></span>
            command.  Entering a new privilege level may require a
            password and the prompt may change as a result of entering
            the level.
          </p><p>
            The AAA data model contains a section for controlling which
            commands are available in the different levels, which prompt
            to use for each level and if a password or secret is configured.
          </p><p>
            The configuration mode commands <span class="emphasis"><em>enable</em></span> and
            <span class="emphasis"><em>privilege</em></span> are used for dynamically modifying this
            configuration. The initial configuration should be
            supplied in the aaa_init.xml file.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8166"></a>16.22.10.&nbsp;File access</h3></div></div></div><p>
            The default behavior is to enforce Unix style access
            restrictions. That is, the users <span class="emphasis"><em>uid</em></span>, <span class="emphasis"><em>gid</em></span>,
            and <span class="emphasis"><em>gids</em></span> are used to control what the user has
            read and write access to.
          </p><p>
            However, it is also possible to jail a CLI user to its
            home directory (or the directory where confd_cli is started).
            This is controlled using the confd.conf parameter
            <span class="emphasis"><em>/confdConfig/cli/restrictedFileAccess</em></span>. If this
            is set to <span class="emphasis"><em>true</em></span>, then the user only has access
            to the home directory, or if a directory is specified
            in a cli command parameter (params/param/type/directory{wd}
            or params/param/type/file{wd}) to that directory.
          </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8175"></a>16.22.11.&nbsp;Help texts</h3></div></div></div><p>
            Help and information texts are specified in a number of
            places. In the yang files the
            <span class="emphasis"><em>tailf:info</em></span> element is used to
            specify a descriptive text that is shown when the user
            enters ? in the CLI. The first sentence of the
            <span class="emphasis"><em>description</em></span> text is used when showing
            one-line descriptions in the CLI, e.g.:
          </p><p>In the YANG file:</p><pre class="programlisting">list ifs {
  tailf:info "Configure interfaces";
  ...
}
list hosts {
  tailf:info "Configure hosts";
  ...
}
list routing-protocol {
  tailf:info "Routing protocols";
  ...
}
</pre><p>In the CLI:</p><pre class="screen">io(config)# config ?
Possible completions:
  hosts                    Configure hosts
  ifs                      Configure interfaces
  routing-protocol         Routing protocols
io(config)# config</pre><p>
            It is also possible to specify help texts for simpleTypes
            in the YANG files. For example:
          </p><pre class="programlisting">typedef service-type {
    type enumeration {
        enum http { tailf:info "Web server"; }
        enum smtp { tailf:info "Mail server"; }
    }
}

typedef service-name {
    tailf:info "Name of service";
    type string;
}</pre><p>When used in the CLI it looks like this:</p><pre class="screen">io(config)# server ?
&lt;name:server type [smtp|www|imap]&gt;
io(config)# server</pre><p>It is also possible to modify the help texts for built-in
          types using the /clispec/$MODE/modifications/typehelp element.
          For example:
          </p><pre class="programlisting">&lt;typehelp type="unsignedShort"&gt;integer&lt;/typehelp&gt;
</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e8190"></a>16.23.&nbsp;User defined wizards</h2></div></div></div><p>
        If our configuration contains large structures that are nontrivial to
        configure in the CLI, we probably wish to add tailor-made
        wizards to the CLI which aid the user in the process.
        Typically we want a wizard to interact with the user, prompt
        the user, read some responses, and depending on the responses,
        populate some structures with reasonable default values
        depending on the user's responses.
      </p><p>
        We can write our wizards either as executables or as callbacks.
        In this section
        we show how to add a user to the AAA namespace using a shell script.
      </p><p>
        The wizard code needs to be able to perform the following tasks:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            It must be able to interact with the user, i.e. it must be able to
            read and write to the CLI terminal.
          </p></li><li class="listitem"><p>
            It must be able to read and write to the db session which
            is used by the CLI. The CLI will start a db session
            whenever it enters configuration mode, the wizard code
            must be able to read and write, not to the database, but
            to the particular db session which is used by the running
            CLI. This is done in a shell script using the maapi command
            which will attach to the current CLI session.
          </p></li></ul></div><p>
        The command to invoke the wizard is added by editing the
        <span class="emphasis"><em>confd.cli</em></span> file, and recompile it. The workings of
        the <span class="emphasis"><em>confd.cli</em></span> file is fully described in the
        UNIX man page <span class="emphasis"><em>clispec(5)</em></span>.
        A new wizard may be added by adding the following in the
        confd.cli file:
      </p><pre class="programlisting">.....
&lt;configureMode&gt;
  .....
  &lt;cmd name="wizard"&gt;
    &lt;info&gt;Configuration wizards&lt;/info&gt;
    &lt;help&gt;Configuration wizards&lt;/help&gt;
    &lt;cmd name="adduser"&gt;
      &lt;info&gt;Create a Confd user&lt;/info&gt;
      &lt;help&gt;
        Create a Confd user and assign him/her to the proper group
        to control what parts of the system he/she has access to.
      &lt;/help&gt;
      &lt;callback&gt;
        &lt;exec&gt;
          &lt;osCommand&gt;./adduser.sh&lt;/osCommand
          &lt;args&gt; &lt;/args&gt;
        &lt;/exec&gt;
      &lt;/callback&gt;
    &lt;/cmd&gt;
  &lt;/cmd&gt;
&lt;/configureMode&gt;</pre><p>
        This way, once inside configuration mode,
        the command "wizard adduser" will be available. The type of the
        callback is &lt;exec&gt;, indicating that the wizard is implemented
        as an executable.
      </p><p>For example, adduser.sh:</p><div class="informalexample"><pre class="programlisting"><em class="hl-comment" style="color: silver">#!/bin/bash</em>

<em class="hl-comment" style="color: silver">## Ask for user name</em>
<strong class="hl-keyword">while</strong> true; <strong class="hl-keyword">do</strong>
    <strong class="hl-keyword">echo</strong> -n <strong class="hl-string"><em style="color:red">"Enter user name: "</em></strong>
    <strong class="hl-keyword">read</strong> user

    <strong class="hl-keyword">if</strong> [ ! -n <strong class="hl-string"><em style="color:red">"${user}"</em></strong> ]; <strong class="hl-keyword">then</strong>
	<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"You failed to supply a user name."</em></strong>
    <strong class="hl-keyword">elif</strong> maapi --exists <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/users/user{${user}}"</em></strong>; <strong class="hl-keyword">then</strong>
	<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"The user already exists."</em></strong>
    <strong class="hl-keyword">else</strong>
	<strong class="hl-keyword">break</strong>
    <strong class="hl-keyword">fi</strong>
<strong class="hl-keyword">done</strong>

<em class="hl-comment" style="color: silver">## Ask for password</em>
<strong class="hl-keyword">while</strong> true; <strong class="hl-keyword">do</strong>
    <strong class="hl-keyword">echo</strong> -n <strong class="hl-string"><em style="color:red">"Enter password: "</em></strong>
    <strong class="hl-keyword">read</strong> -s pass1
    <strong class="hl-keyword">echo</strong>

    <strong class="hl-keyword">if</strong> [ <strong class="hl-string"><em style="color:red">"${pass1:0:1}"</em></strong> == <strong class="hl-string"><em style="color:red">"$"</em></strong> ]; <strong class="hl-keyword">then</strong>
	<strong class="hl-keyword">echo</strong> -n <strong class="hl-string"><em style="color:red">"The password must not start with $. Please choose a "</em></strong>
	<strong class="hl-keyword">echo</strong>    <strong class="hl-string"><em style="color:red">"different password."</em></strong>
    <strong class="hl-keyword">else</strong>
	<strong class="hl-keyword">echo</strong> -n <strong class="hl-string"><em style="color:red">"Confirm password: "</em></strong>
	<strong class="hl-keyword">read</strong> -s pass2
	<strong class="hl-keyword">echo</strong>

	<strong class="hl-keyword">if</strong> [ <strong class="hl-string"><em style="color:red">"${pass1}"</em></strong> != <strong class="hl-string"><em style="color:red">"${pass2}"</em></strong> ]; <strong class="hl-keyword">then</strong>
	    <strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"Passwords do not match."</em></strong>
	<strong class="hl-keyword">else</strong>
	    <strong class="hl-keyword">break</strong>
	<strong class="hl-keyword">fi</strong>
    <strong class="hl-keyword">fi</strong>
<strong class="hl-keyword">done</strong>

groups=`maapi --keys <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/groups/group"</em></strong>`
<strong class="hl-keyword">while</strong> true; <strong class="hl-keyword">do</strong>
    <strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"Choose a group for the user."</em></strong>
    <strong class="hl-keyword">echo</strong> -n <strong class="hl-string"><em style="color:red">"Available groups are: "</em></strong>
    <strong class="hl-keyword">for</strong> i in ${groups}; <strong class="hl-keyword">do</strong> <strong class="hl-keyword">echo</strong> -n <strong class="hl-string"><em style="color:red">"${i} "</em></strong>; <strong class="hl-keyword">done</strong>    
    <strong class="hl-keyword">echo</strong>
    <strong class="hl-keyword">echo</strong> -n <strong class="hl-string"><em style="color:red">"Enter group for user: "</em></strong>
    <strong class="hl-keyword">read</strong> group

    <strong class="hl-keyword">if</strong> [ ! -n <strong class="hl-string"><em style="color:red">"${group}"</em></strong> ]; <strong class="hl-keyword">then</strong>
	<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"You must enter a valid group."</em></strong>
    <strong class="hl-keyword">else</strong>
	<strong class="hl-keyword">for</strong> i in ${groups}; <strong class="hl-keyword">do</strong>
	    <strong class="hl-keyword">if</strong> [ <strong class="hl-string"><em style="color:red">"${i}"</em></strong> == <strong class="hl-string"><em style="color:red">"${group}"</em></strong> ]; <strong class="hl-keyword">then</strong>
		<em class="hl-comment" style="color: silver"># valid group found</em>
		<strong class="hl-keyword">break</strong> <span class="hl-number">2</span>;
	    <strong class="hl-keyword">fi</strong>
	<strong class="hl-keyword">done</strong>
	<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"You entered an invalid group."</em></strong>
    <strong class="hl-keyword">fi</strong>
    <strong class="hl-keyword">echo</strong>
<strong class="hl-keyword">done</strong>

<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"Creating user"</em></strong>

maapi --create <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/users/user{${user}}"</em></strong>
maapi --<strong class="hl-keyword">set</strong> <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/users/user{${user}}/password"</em></strong> <strong class="hl-string"><em style="color:red">"${pass1}"</em></strong>

<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"Setting home directory to: /var/confd/homes/${user}"</em></strong>
maapi --<strong class="hl-keyword">set</strong> <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/users/user{${user}}/homedir"</em></strong> \
            <strong class="hl-string"><em style="color:red">"/var/confd/homes/${user}"</em></strong>

<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"Setting ssh key directory to: /var/confd/homes/${user}/ssh_keydir"</em></strong>
maapi --<strong class="hl-keyword">set</strong> <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/users/user{${user}}/ssh_keydir"</em></strong> \
            <strong class="hl-string"><em style="color:red">"/var/confd/homes/${user}/ssh_keydir"</em></strong>

maapi --<strong class="hl-keyword">set</strong> <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/users/user{${user}}/uid"</em></strong> <strong class="hl-string"><em style="color:red">"1000"</em></strong>
maapi --<strong class="hl-keyword">set</strong> <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/users/user{${user}}/gid"</em></strong> <strong class="hl-string"><em style="color:red">"100"</em></strong>

<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"Adding user to the ${group} group."</em></strong>
gusers=`maapi --get <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/groups/group{${group}}/users"</em></strong>`

<strong class="hl-keyword">for</strong> i in ${gusers}; <strong class="hl-keyword">do</strong>
    <strong class="hl-keyword">if</strong> [ <strong class="hl-string"><em style="color:red">"${i}"</em></strong> == <strong class="hl-string"><em style="color:red">"${user}"</em></strong> ]; <strong class="hl-keyword">then</strong>
	<strong class="hl-keyword">echo</strong> <strong class="hl-string"><em style="color:red">"User already in group"</em></strong>
	<strong class="hl-keyword">exit</strong> <span class="hl-number">0</span>
    <strong class="hl-keyword">fi</strong>
<strong class="hl-keyword">done</strong>

maapi --<strong class="hl-keyword">set</strong> <strong class="hl-string"><em style="color:red">"/aaa:aaa/authentication/groups/group{${group}}/users"</em></strong> \
            <strong class="hl-string"><em style="color:red">"${gusers} ${user}"</em></strong>



</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e8209"></a>16.24.&nbsp;User defined wizards in C</h2></div></div></div><p>
        We can write precisely the same wizard in C as well. This example
        makes use of the MAAPI interface, described in the UNIX man page
        <a class="xref" href="rn02re14.html" title="confd_lib_maapi"><span class="refentrytitle">confd_lib_maapi</span>(3)</a> as well as in the user
        guide chapter
        "MAAPI - Management Agent API". Thus to fully understand this section,
        the MAAPI documentation must be read.
      </p><p>Similar to the shell script wizard we must modify the clispec
      file <span class="emphasis"><em>"confd.cli"</em></span> to indicate the name of a program
      to execute. We have:</p><div class="informalexample"><pre class="programlisting">&lt;configureMode&gt;
  .....
  &lt;cmd name="wizard"&gt;
    &lt;info&gt;Configuration wizards&lt;/info&gt;
    &lt;help&gt;Configuration wizards&lt;/help&gt;

    &lt;cmd name="cadduser"&gt;
      &lt;info&gt;Add a user&lt;/info&gt;
      &lt;help&gt;Add a user&lt;/help&gt;
      &lt;callback&gt;
        &lt;exec&gt;
          &lt;osCommand&gt;/usr/local/bin/maapi_add_user&lt;/osCommand&gt;
          &lt;options&gt;
            &lt;uid&gt;user&lt;/uid&gt;
          &lt;/options&gt;
        &lt;/exec&gt;
      &lt;/callback&gt;
    &lt;/cmd&gt;
    ....
  &lt;/cmd&gt;
&lt;/configureMode&gt;</pre></div><p>
        Using our modified <span class="emphasis"><em>"confd.cli"</em></span>, a command called
        "wizard cadduser" will be available in the CLI configuration mode.
        When this CLI command is executed, the ConfD CLI will invoke the
        external program called <span class="emphasis"><em>"/usr/local/bin/maapi_add_user"</em></span>.
      </p><p>
        This program will execute under a pseudo terminal (pty) which
        is connected to the actual CLI terminal. Thus the external
        programs invoked by the CLI can manipulate the terminal - not
        just stdin and stdout.
      </p><p>The invoked program will have two environment variables set which
      can be used in the MAAPI interface to create an attached MAAPI session
      towards the currently executing transaction in the CLI.
      Thus the program must read <span class="emphasis"><em>"CONFD_MAAPI_USID"</em></span> and
      <span class="emphasis"><em>"CONFD_MAAPI_THANDLE"</em></span> from its environment.
      </p><p>Another thing which is different in the C implementation
      of a CLI wizard is that the C code must be explicitly aware of
      which namespace it wants to manipulate. In our case, where we
      wish to add a user, we wish to manipulate the AAA namespace,
      <span class="emphasis"><em>"http://tail-f.com/ns/aaa/1.1"</em></span>. The data
      model defining the AAA namespace is included in a ConfD release
      and when the data model is compiled a .h file is generated which
      contains the symbols defined in the namespace. This .h file must
      be included.  Thus:</p><div class="informalexample"><pre class="programlisting">.....

#include "confd_lib.h"
#include "confd_maapi.h"
#include "aaa_bridge.h"

int main(int argc, char **argv)
{
    int msock;
    int debuglevel = CONFD_DEBUG;
    struct in_addr in;
    struct sockaddr_in addr;
    int usid, thandle;
    char user[255], *pwd, home[255], sshdir[255];
    char buf[BUFSIZ];
    inet_aton("127.0.0.1", &amp;amp;in);
    addr.sin_addr.s_addr = in.s_addr;
    addr.sin_family = AF_INET;
    addr.sin_port = htons(4565);

    confd_init("adduser", stderr, debuglevel);
    confd_load_schemas((struct sockaddr*)&amp;amp;addr,
                       sizeof (struct sockaddr_in));
    if ((msock = socket(PF_INET, SOCK_STREAM, 0)) &lt; 0 )
        confd_fatal("Failed to open socket\n");

    if (maapi_connect(msock, (struct sockaddr*)&amp;amp;addr,
                      sizeof (struct sockaddr_in)) &lt; 0)
        confd_fatal("Failed to confd_connect() to confd: %s\n",
                    confd_lasterr());
    usid = atoi(getenv("CONFD_MAAPI_USID"));
    thandle = atoi(getenv("CONFD_MAAPI_THANDLE"));

    if ((maapi_attach2(msock, aaa__ns, usid, thandle)) != CONFD_OK)
        confd_fatal("Failed to attach: %s\n", confd_lasterr());

  again0:
    printf("Adding a user\n");
    printf("Username: ");
    if ((fgets(user,255, stdin)) == NULL)
        exit(1);
    user[strlen(user)-1] = 0;
    if (maapi_cd(msock,thandle,"/aaa/authentication/users") != CONFD_OK)
        confd_fatal("cannot CD: %s", confd_lasterr());

    /* check if user exists */
    if (maapi_exists(msock, thandle,"user{%s}", user) == 1) {
        printf("user %s already exists: %s\n", user, confd_lasterr());
        goto again0;
    }

  again:
    if ((pwd = getpass("Password: ")) == NULL)
        exit(1);
    strcpy(buf, pwd);
    if ((pwd = getpass("Confirm password: ")) == NULL)
        exit(1);
    if (strcmp(pwd, buf) != 0) {
        printf("Password not confirmed\n");
        goto again;
    }

    printf("Home: ");
    if ((fgets(home,255,stdin)) == NULL)
        exit(1);
    home[strlen(home)-1] = 0;


    printf("SSH dir: ");
    if ((fgets(sshdir, 255, stdin)) == NULL)
        exit(1);
    sshdir[strlen(sshdir)-1] = 0;



    if (maapi_create(msock,thandle,"user{%s}",user) != CONFD_OK)
        confd_fatal("failed to create user %s: %s\n", user, confd_lasterr());

    if (maapi_set_elem2(msock,thandle,sshdir,"user{%s}/ssh_keydir",user) !=
        CONFD_OK)
        confd_fatal("failed to set ssh keydir: %s\n", confd_lasterr());

    if (maapi_set_elem2(msock,thandle,pwd,"user{%s}/password",user) !=
        CONFD_OK)
        confd_fatal("failed to set password: %s\n", confd_lasterr());

    if (maapi_set_elem2(msock,thandle,home,"user{%s}/homedir",user) !=
        CONFD_OK)
        confd_fatal("failed to set home: %s\n", confd_lasterr());

    printf("user %s added successfully \n", user);
    exit(0);
}</pre></div><p>
        The code illustrates several points:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            It reads the above mentioned environment variables
            and calls <code class="function">maapi_attach2()</code> to attach to
            the transaction.
          </p></li><li class="listitem"><p>
            The code includes the generated .h file from the AAA
            namespace. Furthermore, since the code is manipulating the
            AAA namespace.
          </p></li><li class="listitem"><p>
            It makes use of the libc function <code class="function">getpass()</code> which
            opens "/dev/tty" to read a password without echoing the
            characters entered by the user.
          </p></li><li class="listitem"><p>
            It uses the MAAPI interface to read and write data. Once the
            program returns, the data written by the program is still
            not committed. Not until the user executes the <span class="command"><strong>commit</strong></span>
            command in the CLI will the data be actually written to
            the database opened by the CLI, whether running or the
            candidate.
          </p></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e8241"></a>16.25.&nbsp;User defined commands in C using the C-API</h2></div></div></div><p>
        A command can be implemented as a C-callback using the
        same API as used for actions, with some minor modifications of the
        input parameters.
      </p><p>
        The arguments to the command are passed as string params
        where the first param is the full name of the command,
        and the remaining params are the arguments that were used
        when invoking the command from the CLI.
      </p><p>
        Maapi contains five CLI related functions which can be used
        for reading and writing to the CLI from inside an action
        invoked from the CLI - maapi_cli_write, maapi_cli_printf,
        maapi_cli_prompt, maapi_cli_prompt_oneof, and maapi_cli_read_eof.
      </p><p>Similar to commands implemented as
      executables, there is an option in the confd.cli file for
      specifying that the command is implemented through a CAPI
      callback. It may look like this:
      </p><div class="informalexample"><pre class="programlisting">&lt;configureMode&gt;
  ...
    &lt;cmd name="ctest"&gt;
      &lt;info&gt;C-API command example&lt;/info&gt;
      &lt;help&gt;C-API command example&lt;/help&gt;
      &lt;callback&gt;
        &lt;capi&gt;
          &lt;cmdpoint&gt;testcommand&lt;/cmdpoint&gt;
        &lt;/capi&gt;
      &lt;/callback&gt;
    &lt;/cmd&gt;
  ...
&lt;/configureMode&gt;</pre></div><p>
        The capi tag tells confd that the command is implemented using
        CAPI and the cmdpoint is the name of the action callback to
        invoke when the command is used from the CLI.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e8250"></a>16.26.&nbsp;User defined commands as shell scripts</h2></div></div></div><p>
        ConfD comes with a small C program called
        <span class="emphasis"><em>maapi</em></span>. This program can be used inside
        shell scripts that are defined as CLI commands, as exemplified
        in the add_user.sh script above. The
        <span class="emphasis"><em>maapi</em></span> program is thoroughly described in
        the man page <span class="emphasis"><em>maapi(1)</em></span>.
      </p><p>
        The program attaches itself to the current transaction using
        <span class="emphasis"><em>maapi_attach()</em></span> (see <a class="xref" href="rn02re14.html" title="confd_lib_maapi"><span class="refentrytitle">confd_lib_maapi</span>(3)</a>) and executes a single
        change.
      </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e8259"></a>16.27.&nbsp;Modifying built-in commands</h2></div></div></div><p>
      There are a number of built-in commands which can be modified in
      a number of ways. There should not be confused with the auto-rendered
      commands which cannot be modified in the same way. The auto-rendered
      commands are derived from the data-model at run-time and does not
      exist when confd is started. The section below only relates to the
      built-in commands.
    </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8262"></a>16.27.1.&nbsp;Renaming a command</h3></div></div></div><p>
        A built-in command often consists of a command name part and
        a parameter part. For example, the command <span class="command"><strong>config</strong></span>
        in C-mode has the name <span class="emphasis"><em>config</em></span> and takes
        an optional parameter which can be either <span class="emphasis"><em>terminal</em></span>
        or <span class="emphasis"><em>exclusive</em></span>.
      </p><p>
        It is possible to rename the command <span class="command"><strong>config</strong></span>
        but not the command argument. I.e. the following is possible,
      </p><div class="informalexample"><pre class="programlisting">&lt;operationalMode&gt;
  &lt;modifications&gt;
    &lt;move src="config" dest="configure"/&gt;
  &lt;/modifications&gt;
&lt;/operationalMode&gt;</pre></div><p>
        The following will not work since the command is
        <span class="emphasis"><em>config</em></span> not <span class="emphasis"><em>config terminal</em></span>.
      </p><div class="informalexample"><pre class="programlisting">&lt;operationalMode&gt;
  &lt;modifications&gt;
    &lt;move src="config terminal" dest="config private"/&gt;
  &lt;/modifications&gt;
&lt;/operationalMode&gt;</pre></div><p>
        In the general case it is difficult to know what are commands
        and what are arguments to the command. The above could have been
        defined as two commands <span class="command"><strong>config private</strong></span> and
        <span class="command"><strong>config exclusive</strong></span> without affecting the CLI
        behavior. Using <span class="command"><strong>confd --cli-c-dump</strong></span> can be
        used for determining which part is a command name and which
        parts are command arguments.
      </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8282"></a>16.27.2.&nbsp;Hiding the old, creating new</h3></div></div></div><p>
        If you want to change the way a builtin command works, for
        example the <span class="command"><strong>config</strong></span> command above. There
        is a trick that can be used. It consists of renaming the
        original command and hiding it. Then add your own command
        and have it invoke the original hidden command.
      </p><p>
        Suppose we want to change the config command above to
        take the parameters <span class="emphasis"><em>private</em></span> and
        <span class="emphasis"><em>exclusive</em></span> instead of <span class="emphasis"><em>
        terminal</em></span> and <span class="emphasis"><em>exclusive</em></span>.
        This is the way to do it:
      </p><div class="informalexample"><pre class="programlisting">&lt;operationalMode&gt;
  &lt;modifications&gt;
    &lt;move src="config" dest="xxconfig"/&gt;
    &lt;hide src="xxconfig"/&gt;
  &lt;/modifications&gt;
    &lt;cmd name="config"&gt;
      &lt;info&gt;Manipulate software configuration information&lt;/info&gt;
      &lt;help&gt;Manipulate software configuration information&lt;/help&gt;
      &lt;callback&gt;
        &lt;exec&gt;&lt;osCommand&gt;/usr/local/bin/config.sh&lt;/osCommand&gt;&lt;/exec&gt;
      &lt;/callback&gt;
      &lt;params&gt;
        &lt;param&gt;
          &lt;type&gt;
            &lt;enumerate&gt;
              &lt;enum&gt;
                &lt;name&gt;private&lt;/name&gt;
                &lt;info&gt;non-locked editing of configuration&lt;/info&gt;
              &lt;/enum&gt;
              &lt;enum&gt;
                &lt;name&gt;exclusive&lt;/name&gt;
                &lt;info&gt;locked editing of configuration&lt;/info&gt;
              &lt;/enum&gt;
            &lt;/enumerate&gt;
          &lt;/type&gt;
        &lt;/param&gt;
      &lt;/params&gt;
    &lt;/cmd&gt;
&lt;/operationalMode&gt;</pre></div><div class="informalexample"><pre class="programlisting">#!/bin/bash

case $1 in
private)
        maapi --clicmd --no-hidden 'xxconfig terminal'
        ;;
shared)
        maapi --clicmd --no-hidden 'xxconfig shared'
        ;;
*)
        maapi --clicmd --no-hidden 'xxconfig terminal'
        ;;
esac
</pre></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e8295"></a>16.28.&nbsp;Tailoring show commands</h2></div></div></div><p>
      There are several ways show commands can be tailored in the CLI.
      The data model can be modified, explicit commands can be defined
      in the clispec files, the auto-rendered commands can be tweaked
      using clispec modifications, specific show callbacks can be
      defined in the clispec files, and show templates can be defined
      in the clispec files.
    </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8298"></a>16.28.1.&nbsp;How config="false" data is rendered</h3></div></div></div><p>
        By default the CLI will create show commands in operational mode
        for displaying config="false" data. Leaves and containers will
        be displayed as Name-Value pairs whereas list elements will be
        displayed as tables, provided that the table will fit on the
        terminal screen.
      </p><p>
        A leaf element is rendered as follows:
      </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="354"><tr><td align="center"><img src="pics/cli_showStatus.png" align="middle" width="354"></td></tr></table><div class="caption"><p>Rendering of leaves and containers</p></div></div><p>
        Two different algorithms are used when rendering list elements.
        One for rendering a single element and one for rendering multiple
        elements (either the entire table or a subset of the table).
      </p><p>
        When rendering a single element the following method is used:
      </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="354"><tr><td align="center"><img src="pics/cli_showTemplateOne.png" align="middle" width="354"></td></tr></table><div class="caption"><p>Rendering of a single list element</p></div></div><p>
        And when rendering a set of list elements the following is used:
      </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="425"><tr><td align="center"><img src="pics/cli_showTemplate.png" align="middle" width="425"></td></tr></table><div class="caption"><p>Rendering of a set of list elements</p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e8320"></a>16.28.2.&nbsp;Show templates</h3></div></div></div><p>
        Show templates can be used in a few different ways. Either as a
        replacement for the default Name-Value rendering, or for replacing
        the auto-rendered tables. By default only the Name-Value rendering
        is replaced when a show template is defined, i.e. the show template
        will only be invoked for list elements if the table is too wide
        for the screen (or if table view has been suppressed in some
        other way).
      </p><p>
        In order to also replace the default table rendering with the
        show template the auto-rendered table needs to be suppressed.
        This is done using the YANG tailf:cli-suppress-table statement
        in the YANG file.
      </p><p>
        If a show template is used for rendering a table then the
        show template needs to render the table header, this is done
        using a tailf:cli-show-template-legend statement. It also needs to
        suppress the default <span class="emphasis"><em>enter</em></span> text that
        is displayed for each instance. This is done by defining
        an empty tailf:cli-show-template-enter template. Finally,
        a show template
        needs to be defined for the list element node that renders
        each table line. A customized footer can be displayed by using
        a tailf:cli-show-template-footer statement.
      </p><p>
        The above will work fine when displaying an entire table. However,
        when displaying a single instance it might be desirable to either
        display it as a table line, in which case a table header also
        needs to be displayed, or in some other way. The problem is that
        the same show template is used in both situations.
      </p><p>
        The solution is to add a conditional in the template and display
        different texts in the two situations. For example (
        from the <code class="filename">example/cli/show_template/jdemo.yang</code>):
      </p><div class="informalexample"><pre class="programlisting">tailf:cli-show-template
       "$(.legend_shown!=true?"
       +"Address         Interface   "
       +"$(.selected~=hwaddr?HW Address         )"
       +"$(.selected~=permanent?Permant  )"
       +"$(.selected~=published?Published)"
       +"$(.selected~=bignum?$(.show_bignum? Bignum ))\n"
       +"============================"
       +"$(.selected~=hwaddr?===================)"
       +"$(.selected~=permanent?=========)"
       +"$(.selected~=published?=========)"
       +"$(.selected~=bignum?$(.show_bignum?========))\n)"
       +"$(ip|ljust:15) $(ifname|ljust:9) - "
       +"$(.selected~=hwaddr?$(hwaddr|ljust:17)  )"
       +"$(.selected~=permanent?$(permanent|ljust:8) )"
       +"$(.selected~=published?$(published|ljust:7)  )"
       +"$(.selected~=bignum?$(.show_bignum?$(.humanreadable? "
</pre></div><p>
        In the example above the legend is only displayed if it has not already
        been displayed. This is achieved by inspecting the built-in variable
        <code class="varname">.legend_shown</code>. The same behavior can be achieved by
        using the substatement tailf:cli-auto-legend (see listing below).
        The example above also tests on the
        <code class="varname">.selected</code> variable to determine if each column
        has been selected to be displayed using the <span class="command"><strong>select</strong></span>
        pipe command.
      </p><div class="informalexample"><pre class="programlisting">tailf:cli-show-template
       "$(ip|ljust:15) $(ifname|ljust:9) - "
       +"$(.selected~=hwaddr?$(hwaddr|ljust:17)  )"
       +"$(.selected~=permanent?$(permanent|ljust:8) )"
       +"$(.selected~=published?$(published|ljust:7)  )"
       +"$(.selected~=bignum?$(.show_bignum?$(.humanreadable? " {
         tailf:cli-auto-legend;
      }
</pre></div><p>
        It is possible to ask confd to perform a validation of the
        paths that appear in the templates in the YANG files. This
        is done by running the command
        <span class="command"><strong>confd --cli-check-templates</strong></span> once confd has
        been started.
      </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e8339"></a>16.29.&nbsp;Change password at initial login</h2></div></div></div><p>
      To force the user to change the password at initial login,
      or when the password has expired, a start script can be used.
    </p><p>
      The start script is specified in the clispec file. Only one
      start script can be present, if more are present (for example
      in different clispec files) then only one of them will be
      executed (unspecified which).
    </p><p>
      In the clispec file:
    </p><div class="informalexample"><pre class="programlisting">&lt;start&gt;
  &lt;callback&gt;
   &lt;exec&gt;
   &lt;osCommand&gt;./startup.sh&lt;/osCommand&gt;
      &lt;args&gt;$(user)&lt;/args&gt;
   &lt;/exec&gt;
  &lt;/callback&gt;
&lt;/start&gt;</pre></div><p>
      In startup.sh something along the lines of:
    </p><div class="informalexample"><pre class="programlisting">#!/bin/bash

user=$1
oldpass=`maapi --get "/aaa:aaa/authentication/users/user{${user}}/password"`

echo "oldpass=${oldpass}"

if [ ${oldpass} == '$1$Dd0v2$Rd899rbrbFTeHuEjAtzvW/' ]; then
     echo "You need to set a new password"

## Ask for password

     while true; do
         echo -n "Enter password: "
         read -s pass1
         echo

         if [ "${pass1:0:1}" == "$" ]; then
            echo -n "The password must not start with $. Please choose a "
            echo    "different password."
         else
            echo -n "Confirm password: "
            read -s pass2
            echo

            if [ "${pass1}" != "${pass2}" ]; then
                echo "Passwords do not match."
            else
                break
            fi
         fi
     done
## create new transaction and write password

     confd_cmd -r -m -c \
         "mset /aaa:aaa/authentication/users/user{${user}}/password ${pass1}"

fi

echo "Welcome!"
</pre></div><p>
      Note that the old password needs to be updated to your default
      startup password, or the test changed into something a bit
      more sophisticated.
    </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch15.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch17.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;15.&nbsp;The  NETCONF Server&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;17.&nbsp;The SNMP Agent</td></tr></table></div></body></html>